<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Chan-sccp-users] Chan-sccp-users Digest, Vol 33, Issue 1
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/chan-sccp-users/2009-December/index.html" >
   <LINK REL="made" HREF="mailto:chan-sccp-users%40lists.berlios.de?Subject=Re%3A%20%5BChan-sccp-users%5D%20Chan-sccp-users%20Digest%2C%20Vol%2033%2C%20Issue%201&In-Reply-To=%3C00A24AA921915B4D99E90311BC1632F00D44BC%40exchange2k3.five-fifteen.local%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000489.html">
   <LINK REL="Next"  HREF="000491.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Chan-sccp-users] Chan-sccp-users Digest, Vol 33, Issue 1</H1>
    <B>Juan A. Quintana</B> 
    <A HREF="mailto:chan-sccp-users%40lists.berlios.de?Subject=Re%3A%20%5BChan-sccp-users%5D%20Chan-sccp-users%20Digest%2C%20Vol%2033%2C%20Issue%201&In-Reply-To=%3C00A24AA921915B4D99E90311BC1632F00D44BC%40exchange2k3.five-fifteen.local%3E"
       TITLE="[Chan-sccp-users] Chan-sccp-users Digest, Vol 33, Issue 1">jquintana at simplifieditsolutions.com
       </A><BR>
    <I>Tue Dec  1 15:36:13 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="000489.html">[Chan-sccp-users] Chan-sccp-users Digest, Vol 32, Issue 2
</A></li>
        <LI>Next message: <A HREF="000491.html">[Chan-sccp-users] Chan-sccp-users Digest, Vol 33, Issue 1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#490">[ date ]</a>
              <a href="thread.html#490">[ thread ]</a>
              <a href="subject.html#490">[ subject ]</a>
              <a href="author.html#490">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>David,

I think you are asking for the contents of my sccp.conf correct?

If so, it is attached to this email.

Thanks!


Juan A. Quintana 
www.simplifieditsolutions.com
Simplified IT Solutions
Network Consultant 
8002 Thorncroft Manor Ln
Richmond, TX 77407
&#160;
&#160;
E-mail:
<A HREF="https://lists.berlios.de/mailman/listinfo/chan-sccp-users">jquintana at simplifieditsolutions.com</A> 

&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Office: 
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 832.798.5989 
We do IT right.



The information contained in this E-mail message is privileged, confidential, and may be protected from disclosure; please be aware that any other use, printing, copying, disclosure or dissemination of this communication may be subject to legal restriction or sanction. If you think that you have received this e-mail message in error, please reply to the sender.

This E-mail message and any attachments hereto have been scanned for viruses and are believed to be free of any virus or other defect that might affect any computer system into which it is received and opened. However, it is the responsibility of the recipient to ensure that it is virus free and no responsibility is accepted by Simplified IT Solutions for any loss or damage arising in any way from its use.


-----Original Message-----
From: <A HREF="https://lists.berlios.de/mailman/listinfo/chan-sccp-users">chan-sccp-users-bounces at lists.berlios.de</A> [mailto:<A HREF="https://lists.berlios.de/mailman/listinfo/chan-sccp-users">chan-sccp-users-bounces at lists.berlios.de</A>] On Behalf Of <A HREF="https://lists.berlios.de/mailman/listinfo/chan-sccp-users">chan-sccp-users-request at lists.berlios.de</A>
Sent: Tuesday, December 01, 2009 8:26 AM
To: <A HREF="https://lists.berlios.de/mailman/listinfo/chan-sccp-users">chan-sccp-users at lists.berlios.de</A>
Subject: Chan-sccp-users Digest, Vol 33, Issue 1

Send Chan-sccp-users mailing list submissions to
	<A HREF="https://lists.berlios.de/mailman/listinfo/chan-sccp-users">chan-sccp-users at lists.berlios.de</A>

To subscribe or unsubscribe via the World Wide Web, visit
	<A HREF="https://lists.berlios.de/mailman/listinfo/chan-sccp-users">https://lists.berlios.de/mailman/listinfo/chan-sccp-users</A>
or, via email, send a message with subject or body 'help' to
	<A HREF="https://lists.berlios.de/mailman/listinfo/chan-sccp-users">chan-sccp-users-request at lists.berlios.de</A>

You can reach the person managing the list at
	<A HREF="https://lists.berlios.de/mailman/listinfo/chan-sccp-users">chan-sccp-users-owner at lists.berlios.de</A>

When replying, please edit your Subject line so it is more specific
than &quot;Re: Contents of Chan-sccp-users digest...&quot;


Today's Topics:

   1. Re: Chan-sccp-users Digest, Vol 32, Issue 2 (David Dederscheck)


----------------------------------------------------------------------

Message: 1
Date: Tue, 1 Dec 2009 15:25:25 +0100
From: David Dederscheck &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/chan-sccp-users">davidded at davidded.de</A>&gt;
Subject: Re: [Chan-sccp-users] Chan-sccp-users Digest, Vol 32, Issue 2
To: <A HREF="https://lists.berlios.de/mailman/listinfo/chan-sccp-users">chan-sccp-users at lists.berlios.de</A>
Message-ID: &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/chan-sccp-users">E34E93E6-FEE5-4AA8-8205-C57E2A96080A at davidded.de</A>&gt;
Content-Type: text/plain; charset=US-ASCII; format=flowed; delsp=yes

Hi Juan,

it seems to me as if you have a very short timeout set for overlap  
dialing.

Please post the configuration of chan_sccp to help delineate the issue.


Kind regards,
-David.


On 25.11.2009, at 05:32, Juan A. Quintana wrote:

&gt;<i> Thanks for the reply, Peder.
</I>&gt;<i>
</I>&gt;<i> This is the output of my CLI when I make a call:
</I>&gt;<i>
</I>&gt;<i> -------------------------------------------------------------------------------------------------
</I>&gt;<i>
</I>&gt;<i> Asterisk 1.4.22-4 RPM by <A HREF="https://lists.berlios.de/mailman/listinfo/chan-sccp-users">vc-rpms at voipconsulting.nl</A>, Copyright (C)  
</I>&gt;<i> 1999 - 2008 Digium, Inc. and others.
</I>&gt;<i> Created by Mark Spencer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/chan-sccp-users">markster at digium.com</A>&gt;
</I>&gt;<i> Asterisk comes with ABSOLUTELY NO WARRANTY; type 'core show  
</I>&gt;<i> warranty' for details.
</I>&gt;<i> This is free software, with components licensed under the GNU  
</I>&gt;<i> General Public
</I>&gt;<i> License version 2 and other licenses; you are welcome to  
</I>&gt;<i> redistribute it under
</I>&gt;<i> certain conditions. Type 'core show license' for details.
</I>&gt;<i> = 
</I>&gt;<i> = 
</I>&gt;<i> = 
</I>&gt;<i> ======================================================================
</I>&gt;<i>  == Parsing '/etc/asterisk/asterisk.conf': Found
</I>&gt;<i> Connected to Asterisk 1.4.22-4 RPM by <A HREF="https://lists.berlios.de/mailman/listinfo/chan-sccp-users">vc-rpms at voipconsulting.nl</A>  
</I>&gt;<i> currently running on trixbox (pid = 22784)
</I>&gt;<i> Verbosity was 3 and is now 5
</I>&gt;<i>    -- SEP00136090A798: Accessory 'Speaker' is 'OffHook' (0)
</I>&gt;<i>    -- SEP00136090A798: Cisco Digit: 00000001 (1) on line 1401
</I>&gt;<i>    -- SEP00136090A798: Cisco Digit: 00000001 (1) on line 1401
</I>&gt;<i>    -- SEP00136090A798: Cisco Digit: 00000000 (0) on line 1401
</I>&gt;<i>    -- SEP00136090A798: Cisco Digit: 00000001 (1) on line 1401
</I>&gt;<i> SCCP: Timeout for callid '11'. Going to dial '1101'
</I>&gt;<i>    -- SCCP: Unable to cancel schedule ID 42.
</I>&gt;<i>    -- SEP00136090A798: (sccp_pbx_softswitch) New call on line 1401
</I>&gt;<i>    -- SEP00136090A798: Accessory 'Speaker' is 'OnHook' (0)
</I>&gt;<i>    -- SEP00136090A798: Accessory 'Handset' is 'OffHook' (0)
</I>&gt;<i>    -- SEP00136090A798: Accessory 'Handset' is 'OnHook' (0)
</I>&gt;<i>    -- SEP00136090A798 is Onhook
</I>&gt;<i>    -- SEP00136090A798: Ending call 11 on line 1401
</I>&gt;<i>    -- SCCP: Asterisk request to hangup channel SCCP/1401-0000000b
</I>&gt;<i>    -- SCCP: Request to schedule delete for channel '11' in 10 seconds
</I>&gt;<i>    -- SCCP: Channel '11' freed by schedule.
</I>&gt;<i> trixbox*CLI&gt;
</I>&gt;<i>
</I>&gt;<i> -------------------------------------------------------------------------------------------------
</I>&gt;<i>
</I>&gt;<i> This is my extensions.conf:
</I>&gt;<i>
</I>&gt;<i> -------------------------------------------------------------------------------------------------
</I>&gt;<i>
</I>&gt;<i> ;--------------------------------------------------------------------------------;
</I>&gt;<i> ; Do NOT edit this file as it is auto-generated by FreePBX. All  
</I>&gt;<i> modifications to ;
</I>&gt;<i> ; this file must be done via the web gui. There are alternative  
</I>&gt;<i> files to make    ;
</I>&gt;<i> ; custom modifications, details at: <A HREF="http://freepbx.org/configuration_files">http://freepbx.org/configuration_files</A> 
</I>&gt;<i>        ;
</I>&gt;<i> ;--------------------------------------------------------------------------------;
</I>&gt;<i> ;
</I>&gt;<i>
</I>&gt;<i> ; FreePBX
</I>&gt;<i> ; Copyright (C) 2004 Coalescent Systems Inc (Canada)
</I>&gt;<i> ; Copyright (C) 2006 Why Pay More 4 Less Pty Ltd (Australia)
</I>&gt;<i> ; Copyright (C) 2007 Astrogen LLC (USA)
</I>&gt;<i> ; Released under the GNU GPL Licence version 2.
</I>&gt;<i>
</I>&gt;<i> ; dialparties.agi (<A HREF="http://www.sprackett.com/asterisk/">http://www.sprackett.com/asterisk/</A>)
</I>&gt;<i> ; Asterisk::AGI (<A HREF="http://asterisk.gnuinter.net/">http://asterisk.gnuinter.net/</A>)
</I>&gt;<i> ; gsm (<A HREF="http://www.ibiblio.org/pub/Linux/utils/compress/!INDEX.short.html">http://www.ibiblio.org/pub/Linux/utils/compress/!INDEX.short.html</A> 
</I>&gt;<i> )
</I>&gt;<i> ; loligo sounds (<A HREF="http://www.loligo.com/asterisk/sounds/">http://www.loligo.com/asterisk/sounds/</A>)
</I>&gt;<i> ; mpg123 (<A HREF="http://voip-info.org/wiki-Asterisk+config+musiconhold.conf">http://voip-info.org/wiki-Asterisk+config+musiconhold.conf</A>)
</I>&gt;<i>
</I>&gt;<i> ;**************************  -WARNING-   
</I>&gt;<i> ****************************************
</I>&gt;<i> ;                                                                              *
</I>&gt;<i> ; This include file is to be used with extreme caution. In almost  
</I>&gt;<i> all cases    *
</I>&gt;<i> ; any custom dialplan SHOULD be put in extensions_custom.conf which  
</I>&gt;<i> will       *
</I>&gt;<i> ; not hurt a FreePBX generated dialplan. In some very rare and  
</I>&gt;<i> custom          *
</I>&gt;<i> ; situations users may have a need to override what freepbx  
</I>&gt;<i> automatically      *
</I>&gt;<i> ; generates. If so anything in this file will do that.  If you come  
</I>&gt;<i> up with a  *
</I>&gt;<i> ; situation where you need to modify the existing dialplan or macro,  
</I>&gt;<i> please    *
</I>&gt;<i> ; put it here and also notify the FreePBX development team so they  
</I>&gt;<i> can take it *
</I>&gt;<i> ; into account in the  
</I>&gt;<i> future.                                                  *
</I>&gt;<i> ;                                                                              *
</I>&gt;<i> #include extensions_override_freepbx.conf
</I>&gt;<i> ;                                                                              *
</I>&gt;<i> ;**************************  -WARNING-   
</I>&gt;<i> ****************************************
</I>&gt;<i>
</I>&gt;<i> ; include extension contexts generated from AMP
</I>&gt;<i> #include extensions_additional.conf
</I>&gt;<i>
</I>&gt;<i> ; Customizations to this dialplan should be made in  
</I>&gt;<i> extensions_custom.conf
</I>&gt;<i> ; See extensions_custom.conf.sample for an example.
</I>&gt;<i> ; If you need to use [macro-dialout-trunk-predial-hook], [ext-did- 
</I>&gt;<i> custom], or
</I>&gt;<i> ; [from-internal-custom] for example, place these in this file or  
</I>&gt;<i> they will get overwritten.
</I>&gt;<i> ;
</I>&gt;<i> #include extensions_custom.conf
</I>&gt;<i>
</I>&gt;<i> [from-trunk]							; just an alias since VoIP shouldn't be called PSTN
</I>&gt;<i> include =&gt; from-pstn
</I>&gt;<i>
</I>&gt;<i> [from-pstn]
</I>&gt;<i> include =&gt; from-pstn-custom                     ; create this  
</I>&gt;<i> context in extensions_custom.conf to include customizations
</I>&gt;<i> include =&gt; ext-did
</I>&gt;<i> include =&gt; ext-did-post-custom
</I>&gt;<i> include =&gt; from-did-direct		; MODIFICATOIN (PL) for findmefollow if  
</I>&gt;<i> enabled, should be bofore ext-local
</I>&gt;<i> include =&gt; ext-did-catchall		; THIS MUST COME AFTER ext-did
</I>&gt;<i> exten =&gt; fax,1,Goto(ext-fax,in_fax,1)
</I>&gt;<i>
</I>&gt;<i> ; MODIFICATION (PL)
</I>&gt;<i> ;
</I>&gt;<i> ; Required to assure that direct dids go to personal ring group  
</I>&gt;<i> before local extension.
</I>&gt;<i> ; This could be auto-generated however I it is prefered to be put  
</I>&gt;<i> here and hard coded
</I>&gt;<i> ; so that it can be modified if ext-local should take precedence in  
</I>&gt;<i> certain situations.
</I>&gt;<i> ; will have to decide what to do later.
</I>&gt;<i> ;
</I>&gt;<i> [from-did-direct]
</I>&gt;<i> include =&gt; ext-findmefollow
</I>&gt;<i> include =&gt; ext-local
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ;  
</I>&gt;<i> ############################################################################
</I>&gt;<i> ; Macros [macro]
</I>&gt;<i> ;  
</I>&gt;<i> ############################################################################
</I>&gt;<i>
</I>&gt;<i> ; Rings one or more extensions.  Handles things like call forwarding  
</I>&gt;<i> and DND
</I>&gt;<i> ; We don't call dial directly for anything internal anymore.
</I>&gt;<i> ; ARGS: $TIMER, $OPTIONS, $EXT1, $EXT2, $EXT3, ...
</I>&gt;<i> ; Use a Macro call such as the following:
</I>&gt;<i> ;  Macro(dial,$DIAL_TIMER,$DIAL_OPTIONS,$EXT1,$EXT2,$EXT3,...)
</I>&gt;<i> [macro-dial]
</I>&gt;<i> exten =&gt; s,1,GotoIf($[&quot;${MOHCLASS}&quot; = &quot;&quot;]?dial)
</I>&gt;<i> exten =&gt; s,n,SetMusicOnHold(${MOHCLASS})
</I>&gt;<i> exten =&gt; s,n(dial),AGI(dialparties.agi)
</I>&gt;<i> exten =&gt; s,n,NoOp(Returned from dialparties with no extensions to  
</I>&gt;<i> call and DIALSTATUS: ${DIALSTATUS})
</I>&gt;<i>
</I>&gt;<i> exten =&gt; s,n+2(normdial),Dial(${ds})                               ;  
</I>&gt;<i> dialparties will set the priority to 10 if $ds is not null
</I>&gt;<i> exten =&gt; s,n,Set(DIALSTATUS=${IF($[&quot;${DIALSTATUS_CW}&quot;!=&quot;&quot; ]?$ 
</I>&gt;<i> {DIALSTATUS_CW}:${DIALSTATUS})})
</I>&gt;<i> exten =&gt; s,n,GosubIf($[&quot;${SCREEN}&quot; != &quot;&quot;]?${DIALSTATUS},1)
</I>&gt;<i>
</I>&gt;<i> exten =&gt; s,20(huntdial),NoOp(Returned from dialparties with hunt  
</I>&gt;<i> groups to dial )
</I>&gt;<i> exten =&gt; s,n,Set(HuntLoop=0)
</I>&gt;<i> exten =&gt; s,n(a22),GotoIf($[${HuntMembers} &gt;= 1]?a30)  ; if this is  
</I>&gt;<i> from rg-group, don't strip prefix
</I>&gt;<i> exten =&gt; s,n,NoOp(Returning there are no members left in the hunt  
</I>&gt;<i> group to ring)
</I>&gt;<i>
</I>&gt;<i> ; dialparties.agi has setup the dialstring for each hunt member in a  
</I>&gt;<i> variable labeled HuntMember0, HuntMember1 etc for each iteration
</I>&gt;<i> ; and The total number in HuntMembers. So for each iteration, we  
</I>&gt;<i> will update the CALLTRACE Data.
</I>&gt;<i> ;
</I>&gt;<i> exten =&gt; s,n+2(a30),Set(HuntMember=HuntMember${HuntLoop})
</I>&gt;<i> exten =&gt; s,n,GotoIf($[$[&quot;${CALLTRACE_HUNT}&quot; != &quot;&quot; ] &amp; $[&quot;$ 
</I>&gt;<i> {RingGroupMethod}&quot; = &quot;hunt&quot; ]]?a32:a35)
</I>&gt;<i> exten =&gt; s,n(a32),Set(CT_EXTEN=${CUT(FILTERED_DIAL,,$[${HuntLoop} +  
</I>&gt;<i> 1])})
</I>&gt;<i> exten =&gt; s,n,Set(DB(CALLTRACE/${CT_EXTEN})=${CALLTRACE_HUNT})
</I>&gt;<i> exten =&gt; s,n,Goto(s,a42)
</I>&gt;<i>
</I>&gt;<i> ;Set Call Trace for each hunt member we are going to call &quot;Memory  
</I>&gt;<i> groups have multiple members to set CALL TRACE For hence the loop
</I>&gt;<i> ;
</I>&gt;<i> exten =&gt; s,n(a35),GotoIf($[$[&quot;${CALLTRACE_HUNT}&quot; != &quot;&quot; ] &amp; $[&quot;$ 
</I>&gt;<i> {RingGroupMethod}&quot; = &quot;memoryhunt&quot; ]]?a36:a50)
</I>&gt;<i> exten =&gt; s,n(a36),Set(CTLoop=0)
</I>&gt;<i> exten =&gt; s,n(a37),GotoIf($[${CTLoop} &gt; ${HuntLoop}]?a42)  ; if this  
</I>&gt;<i> is from rg-group, don't strip prefix
</I>&gt;<i> exten =&gt; s,n,Set(CT_EXTEN=${CUT(FILTERED_DIAL,,$[${CTLoop} + 1])})
</I>&gt;<i> exten =&gt; s,n,Set(DB(CALLTRACE/${CT_EXTEN})=${CALLTRACE_HUNT})
</I>&gt;<i> exten =&gt; s,n,Set(CTLoop=$[1 + ${CTLoop}])
</I>&gt;<i> exten =&gt; s,n,Goto(s,a37)
</I>&gt;<i>
</I>&gt;<i> exten =&gt; s,n(a42),Dial(${${HuntMember}}${ds})
</I>&gt;<i> exten =&gt; s,n,Set(HuntLoop=$[1 + ${HuntLoop}])
</I>&gt;<i> exten =&gt; s,n,GotoIf($[$[$[&quot;foo${RingGroupMethod}&quot; !=  
</I>&gt;<i> &quot;foofirstavailable&quot;] &amp; $[&quot;foo${RingGroupMethod}&quot; !=  
</I>&gt;<i> &quot;foofirstnotonphone&quot;]] | $[&quot;foo${DialStatus}&quot; = &quot;fooBUSY&quot;]]?a46)
</I>&gt;<i> exten =&gt; s,n,Set(HuntMembers=0)
</I>&gt;<i> exten =&gt; s,n(a46),Set(HuntMembers=$[${HuntMembers} - 1])
</I>&gt;<i> exten =&gt; s,n,Goto(s,a22)
</I>&gt;<i>
</I>&gt;<i> exten =&gt; s,n(a50),DBdel(CALLTRACE/${CT_EXTEN})
</I>&gt;<i> exten =&gt; s,n,Goto(s,a42)
</I>&gt;<i>
</I>&gt;<i> ; For call screening
</I>&gt;<i> exten =&gt; NOANSWER,1,Macro(vm,${SCREEN_EXTEN},BUSY,${IVR_RETVM})
</I>&gt;<i> exten =&gt; NOANSWER,n,GotoIf($[&quot;${IVR_RETVM}&quot; != &quot;RETURN&quot; | &quot;$ 
</I>&gt;<i> {IVR_CONTEXT}&quot; = &quot;&quot;]?bye)
</I>&gt;<i> exten =&gt; NOANSWER,n,Return
</I>&gt;<i> exten =&gt; NOANSWER,n(bye),Macro(hangupcall)
</I>&gt;<i> exten =&gt; TORTURE,1,Goto(app-blackhole,musiconhold,1)
</I>&gt;<i> exten =&gt; TORTURE,n,Macro(hangupcall)
</I>&gt;<i> exten =&gt; DONTCALL,1,Answer
</I>&gt;<i> exten =&gt; DONTCALL,n,Wait(1)
</I>&gt;<i> exten =&gt; DONTCALL,n,Zapateller()
</I>&gt;<i> exten =&gt; DONTCALL,n,Playback(ss-noservice)
</I>&gt;<i> exten =&gt; DONTCALL,n,Macro(hangupcall)
</I>&gt;<i>
</I>&gt;<i> ; make sure hungup calls go here so that proper cleanup occurs from  
</I>&gt;<i> call confirmed calls and the like
</I>&gt;<i> ;
</I>&gt;<i> exten =&gt; h,1,Macro(hangupcall)
</I>&gt;<i>
</I>&gt;<i> ; Ring an extension, if the extension is busy or there is no answer  
</I>&gt;<i> send it
</I>&gt;<i> ; to voicemail
</I>&gt;<i> ; ARGS: $VMBOX, $EXT
</I>&gt;<i> [macro-exten-vm]
</I>&gt;<i> exten =&gt; s,1,Macro(user-callerid)
</I>&gt;<i>
</I>&gt;<i> exten =&gt; s,n,Set(RingGroupMethod=none)
</I>&gt;<i> exten =&gt; s,n,Set(VMBOX=${ARG1})
</I>&gt;<i> exten =&gt; s,n,Set(EXTTOCALL=${ARG2})
</I>&gt;<i> exten =&gt; s,n,Set(CFUEXT=${DB(CFU/${EXTTOCALL})})
</I>&gt;<i> exten =&gt; s,n,Set(CFBEXT=${DB(CFB/${EXTTOCALL})})
</I>&gt;<i> exten =&gt; s,n,Set(RT=${IF($[$[&quot;${VMBOX}&quot;!=&quot;novm&quot;] | $[&quot;foo${CFUEXT}&quot;! 
</I>&gt;<i> =&quot;foo&quot;]]?${RINGTIMER}:&quot;&quot;)})
</I>&gt;<i> exten =&gt; s,n,Macro(record-enable,${EXTTOCALL},IN)
</I>&gt;<i> exten =&gt; s,n,Macro(dial,${RT},${DIAL_OPTIONS},${EXTTOCALL})
</I>&gt;<i> exten =&gt; s,n,GotoIf($[ $[&quot;${VMBOX}&quot; != &quot;novm&quot;] &amp; $[&quot;${SCREEN}&quot; !=  
</I>&gt;<i> &quot;&quot;] &amp; $[&quot;${DIALSTATUS}&quot; = &quot;NOANSWER&quot;] ]?exit,return)
</I>&gt;<i> exten =&gt; s,n,Set(SV_DIALSTATUS=${DIALSTATUS})
</I>&gt;<i> exten =&gt; s,n,GosubIf($[$[&quot;${SV_DIALSTATUS}&quot;=&quot;NOANSWER&quot;] &amp; $[&quot;$ 
</I>&gt;<i> {CFUEXT}&quot;!=&quot;&quot;] &amp; $[&quot;${SCREEN}&quot; = &quot;&quot;]]?docfu,1) ; check for CFU in  
</I>&gt;<i> use on no answer
</I>&gt;<i> exten =&gt; s,n,GosubIf($[$[&quot;${SV_DIALSTATUS}&quot;=&quot;BUSY&quot;] &amp; $[&quot;${CFBEXT}&quot;! 
</I>&gt;<i> =&quot;&quot;]]?docfb,1) ; check for CFB in use on busy
</I>&gt;<i> exten =&gt; s,n,Set(DIALSTATUS=${SV_DIALSTATUS})
</I>&gt;<i> exten =&gt; s,n,NoOp(Voicemail is '${VMBOX}')
</I>&gt;<i> exten =&gt; s,n,GotoIf($[&quot;${VMBOX}&quot; = &quot;novm&quot;]?s-${DIALSTATUS},1) ; no  
</I>&gt;<i> voicemail in use for this extension
</I>&gt;<i> exten =&gt; s,n,NoOp(Sending to Voicemail box ${EXTTOCALL})
</I>&gt;<i> exten =&gt; s,n,Macro(vm,${VMBOX},${DIALSTATUS},${IVR_RETVM})
</I>&gt;<i>
</I>&gt;<i> ; Try the Call Forward on No Answer / Unavailable number
</I>&gt;<i> exten =&gt; docfu,1,Set(RTCFU=${IF($[&quot;${VMBOX}&quot;!=&quot;novm&quot;]?$ 
</I>&gt;<i> {RINGTIMER}:&quot;&quot;)})
</I>&gt;<i> exten =&gt; docfu,n,Dial(Local/${CFUEXT}@from-internal/n,${RTCFU},$ 
</I>&gt;<i> {DIAL_OPTIONS})
</I>&gt;<i> exten =&gt; docfu,n,Return
</I>&gt;<i>
</I>&gt;<i> ; Try the Call Forward on Busy number
</I>&gt;<i> exten =&gt; docfb,1,Set(RTCFB=${IF($[&quot;${VMBOX}&quot;!=&quot;novm&quot;]?$ 
</I>&gt;<i> {RINGTIMER}:&quot;&quot;)})
</I>&gt;<i> exten =&gt; docfb,n,Dial(Local/${CFBEXT}@from-internal/n,${RTCFB},$ 
</I>&gt;<i> {DIAL_OPTIONS})
</I>&gt;<i> exten =&gt; docfb,n,Return
</I>&gt;<i>
</I>&gt;<i> ; Extensions with no Voicemail box reporting BUSY come here
</I>&gt;<i> exten =&gt; s-BUSY,1,NoOp(Extension is reporting BUSY and not passing  
</I>&gt;<i> to Voicemail)
</I>&gt;<i> exten =&gt; s-BUSY,n,GotoIf($[&quot;${IVR_RETVM}&quot; = &quot;RETURN&quot; &amp; &quot;$ 
</I>&gt;<i> {IVR_CONTEXT}&quot; != &quot;&quot;]?exit,1)
</I>&gt;<i> exten =&gt; s-BUSY,n,Playtones(busy)
</I>&gt;<i> exten =&gt; s-BUSY,n,Busy(20)
</I>&gt;<i>
</I>&gt;<i> ; Anything but BUSY comes here
</I>&gt;<i> exten =&gt; _s-.,1,Noop(IVR_RETVM: ${IVR_RETVM} IVR_CONTEXT: $ 
</I>&gt;<i> {IVR_CONTEXT})
</I>&gt;<i> exten =&gt; _s-.,n,GotoIf($[&quot;${IVR_RETVM}&quot; = &quot;RETURN&quot; &amp; &quot;$ 
</I>&gt;<i> {IVR_CONTEXT}&quot; != &quot;&quot;]?exit,1)
</I>&gt;<i> exten =&gt; _s-.,n,Playtones(congestion)
</I>&gt;<i> exten =&gt; _s-.,n,Congestion(10)
</I>&gt;<i>
</I>&gt;<i> ; Short burst of tones then return
</I>&gt;<i> exten =&gt; exit,1,Playback(beep&amp;line-busy-transfer-menu&amp;silence/1)
</I>&gt;<i> exten =&gt; exit,n(return),MacroExit()
</I>&gt;<i>
</I>&gt;<i> ;------------------------------------------------------------------------
</I>&gt;<i> ; [macro-vm]
</I>&gt;<i> ;------------------------------------------------------------------------
</I>&gt;<i> ; CONTEXT:      macro-vm
</I>&gt;<i> ; PURPOSE:      call voicemail system and extend with personal ivr
</I>&gt;<i> ;
</I>&gt;<i> ; Under normal use, this macro will call the voicemail system with  
</I>&gt;<i> the extension and
</I>&gt;<i> ; desired greeting mode of busy, unavailable or as specified with  
</I>&gt;<i> direct voicemail
</I>&gt;<i> ; calls (usually unavailable) when entered from destinations.
</I>&gt;<i> ;
</I>&gt;<i> ; The voicemail system's two greetings have been 'hijacked' as  
</I>&gt;<i> follows to extend the
</I>&gt;<i> ; system by giving the option of a private 'ivr' for each voicemail  
</I>&gt;<i> user. The following
</I>&gt;<i> ; applies to both the busy and unavailable modes of voicemail and  
</I>&gt;<i> can be applied to one
</I>&gt;<i> ; or both, and differently.
</I>&gt;<i> ;
</I>&gt;<i> ; Global Defaults:
</I>&gt;<i> ;
</I>&gt;<i> ; The following are default values, used in both busy and unavail  
</I>&gt;<i> modes if no specific
</I>&gt;<i> ; values are specified.
</I>&gt;<i> ;
</I>&gt;<i> ; VMX_REPEAT
</I>&gt;<i> ;					The number of times to repeat the users message if no option  
</I>&gt;<i> is pressed.
</I>&gt;<i> ; VMX_TIMEOUT
</I>&gt;<i> ;					The timeout to wait after playing message before repeating or  
</I>&gt;<i> giving up.
</I>&gt;<i> ; VMX_LOOPS
</I>&gt;<i> ;					The number of times it should replay the message and check for  
</I>&gt;<i> an option when
</I>&gt;<i> ;					an invalid option is pressed.
</I>&gt;<i> ;
</I>&gt;<i> ; VMX_OPTS_DOVM
</I>&gt;<i> ;					Default voicemail option to use if vm is chosen as an option.  
</I>&gt;<i> No options will
</I>&gt;<i> ;					cause Allison's generic message, 's' will go straight to beep.
</I>&gt;<i> ; VMX_OPTS_TIMEOUT
</I>&gt;<i> ;					Default voicemail option to use if it times out with no  
</I>&gt;<i> options. No options will
</I>&gt;<i> ;					cause Allison's generic message, 's' will go straight to beep.
</I>&gt;<i> ;					IF THE USER PRESSES # - it will look like a timeout as well  
</I>&gt;<i> since no option will
</I>&gt;<i> ;					be presented. If the user wishes to enable a mode where a  
</I>&gt;<i> caller can press #
</I>&gt;<i> ;					during their message and it goes straight to voicemail with  
</I>&gt;<i> only a 'beep' then
</I>&gt;<i> ;					this should be set to 's'.
</I>&gt;<i> ; VMX_OPTS_LOOPS
</I>&gt;<i> ;					Default voicemail option to use if to many wrong options  
</I>&gt;<i> occur. No options will
</I>&gt;<i> ;					cause Allison's generic message, 's' will go straight to beep.
</I>&gt;<i> ;
</I>&gt;<i> ; VMX_CONTEXT
</I>&gt;<i> ;					Default context for user destinations if not supplied in the  
</I>&gt;<i> user's settings
</I>&gt;<i> ; VMX_PRI
</I>&gt;<i> ;					Default priority for user destinations if not supplied in the  
</I>&gt;<i> user's settings
</I>&gt;<i> ;
</I>&gt;<i> ; VMX_TIMEDEST_CONTEXT
</I>&gt;<i> ;					Default context for timeout destination if not supplied in the  
</I>&gt;<i> user's settings
</I>&gt;<i> ; VMX_TIMEDEST_EXT
</I>&gt;<i> ;					Default extension for timeout destination if not supplied in  
</I>&gt;<i> the user's settings
</I>&gt;<i> ; VMX_TIMEDEST_PRI
</I>&gt;<i> ;					Default priority for timeout destination if not supplied in  
</I>&gt;<i> the user's settings
</I>&gt;<i> ;
</I>&gt;<i> ; VMX_LOOPDEST_CONTEXT
</I>&gt;<i> ;					Default context for loops  destination if not supplied in the  
</I>&gt;<i> user's settings
</I>&gt;<i> ; VMX_LOOPDEST_EXT
</I>&gt;<i> ;					Default extension for loops  destination if not supplied in  
</I>&gt;<i> the user's settings
</I>&gt;<i> ; VMX_LOOPDEST_PRI
</I>&gt;<i> ;					Default priority for loops  destination if not supplied in the  
</I>&gt;<i> user's settings
</I>&gt;<i> ;
</I>&gt;<i> ;
</I>&gt;<i> ; The AMPUSER database variable has been extended with a 'vmx' tree  
</I>&gt;<i> (vm-extension). A
</I>&gt;<i> ; duplicate set is included for both unavail and busy. You could  
</I>&gt;<i> choose for to have an
</I>&gt;<i> ; ivr when unavail is taken, but not with busy - or a different once  
</I>&gt;<i> with busy.
</I>&gt;<i> ; The full list is below, each specific entry is futher described:
</I>&gt;<i> ;
</I>&gt;<i> ; state:		Whether teh current mode is enabled or disabled. Anything  
</I>&gt;<i> but 'enabled' is
</I>&gt;<i> ;						treated as disabled.
</I>&gt;<i> ; repeat:		This is the number of times that the users message should  
</I>&gt;<i> be played after the
</I>&gt;<i> ;						timeout if the user has not entered anything. It is just a  
</I>&gt;<i> variable to the
</I>&gt;<i> ;						Read() function which will do the repeating.
</I>&gt;<i> ; timeout:	This is how long to wait after the message has been read  
</I>&gt;<i> for a response from
</I>&gt;<i> ;						the user. A caller can enter a digit any time during the  
</I>&gt;<i> playback.
</I>&gt;<i> ; loops:		This is the number of loops that the system will allow a  
</I>&gt;<i> caller to retry if
</I>&gt;<i> ;						they enter a bad menu choice, before going to the loop  
</I>&gt;<i> failover destination
</I>&gt;<i> ; vmxopts:	This is the vm options to send to the voicemail command  
</I>&gt;<i> used when a specific
</I>&gt;<i> ;						voicemail destination is chosen (inidcated by 'dovm' in the  
</I>&gt;<i> ext field). This is
</I>&gt;<i> ;						typically either set to 's' or left blank. When set to 's'  
</I>&gt;<i> there will be no
</I>&gt;<i> ;						message played when entering the voicemail, just a beep. When  
</I>&gt;<i> blank, you will
</I>&gt;<i> ;						have Allison's generic message played. It is not typical to  
</I>&gt;<i> play the greetings
</I>&gt;<i> ;						since they have been 'hijacked' for these IVR's and from a  
</I>&gt;<i> caller's perspecitive
</I>&gt;<i> ;						this system appears interconnected with the voicemail so  
</I>&gt;<i> instructions can be
</I>&gt;<i> ;						left there.
</I>&gt;<i> ; timedest: The three variables: ext, context and pri are the goto  
</I>&gt;<i> destination if the caller
</I>&gt;<i> ;						enters no options and it timesout. None have to be set and a  
</I>&gt;<i> system default
</I>&gt;<i> ;						will be used. If just ext is set, then defaults will be used  
</I>&gt;<i> for context and
</I>&gt;<i> ;						pri, etc.
</I>&gt;<i> ; loopdest:	This is identical to timedest but used if the caller  
</I>&gt;<i> exceeds the maximum invalid
</I>&gt;<i> ;						menu choices.
</I>&gt;<i> ; [0-9*]:		The user can specify up to 11 ivr options, all as single  
</I>&gt;<i> digits from 0-9 or *. The
</I>&gt;<i> ;						# key can not be used since it is used as a terminator key  
</I>&gt;<i> for the Read command
</I>&gt;<i> ;						and will never be returned. A minimum of the ext must be  
</I>&gt;<i> specified for each valid
</I>&gt;<i> ;						option and as above, the context and priority can also be  
</I>&gt;<i> specified if the default
</I>&gt;<i> ;						is not to be used.
</I>&gt;<i> ;						Option '0' takes on a special meaning. Since a user is able  
</I>&gt;<i> to break out of the
</I>&gt;<i> ;						voicemail command once entering it with a 0, if specified,  
</I>&gt;<i> the 0 destination will
</I>&gt;<i> ;						be used.
</I>&gt;<i> ;						Option '*' can also be used to breakout. It is undecided at  
</I>&gt;<i> this point whether
</I>&gt;<i> ;						providing that option will be used as well. (probably should).
</I>&gt;<i> ;
</I>&gt;<i> ;
</I>&gt;<i> ; /AMPUSER/&lt;ext&gt;/vmx/[busy|unavail]/state:								enabled|disabled
</I>&gt;<i> ; /AMPUSER/&lt;ext&gt;/vmx/[busy|unavail]/repeat:								n (times to  
</I>&gt;<i> repeat message)
</I>&gt;<i> ; /AMPUSER/&lt;ext&gt;/vmx/[busy|unavail]/timeout:							n (timeout to  
</I>&gt;<i> wait for digit)
</I>&gt;<i> ; /AMPUSER/&lt;ext&gt;/vmx/[busy|unavail]/loops:								n (loop returies  
</I>&gt;<i> for invalid entries)
</I>&gt;<i> ; /AMPUSER/&lt;ext&gt;/vmx/[busy|unavail]/vmxopts/dovm:					vmoptions (if  
</I>&gt;<i> ext is dovm)
</I>&gt;<i> ; /AMPUSER/&lt;ext&gt;/vmx/[busy|unavail]/vmxopts/timeout:			vmoptions (if  
</I>&gt;<i> timeout)
</I>&gt;<i> ; /AMPUSER/&lt;ext&gt;/vmx/[busy|unavail]/vmxopts/loops:				vmoptions (if  
</I>&gt;<i> loops)
</I>&gt;<i> ; /AMPUSER/&lt;ext&gt;/vmx/[busy|unavail]/timedest/ext:					extension (if  
</I>&gt;<i> timeout)
</I>&gt;<i> ; /AMPUSER/&lt;ext&gt;/vmx/[busy|unavail]/timedest/context:			context (if  
</I>&gt;<i> timeout)
</I>&gt;<i> ; /AMPUSER/&lt;ext&gt;/vmx/[busy|unavail]/timedest/pri:					priority (if  
</I>&gt;<i> timeout)
</I>&gt;<i> ; /AMPUSER/&lt;ext&gt;/vmx/[busy|unavail]/loopdest/ext:					extension (if  
</I>&gt;<i> too many failures)
</I>&gt;<i> ; /AMPUSER/&lt;ext&gt;/vmx/[busy|unavail]/loopdest/context:			context (if  
</I>&gt;<i> too many failures)
</I>&gt;<i> ; /AMPUSER/&lt;ext&gt;/vmx/[busy|unavail]/loopdest/pri:					priority (if  
</I>&gt;<i> too many failures)
</I>&gt;<i> ; /AMPUSER/&lt;ext&gt;/vmx/[busy|unavail]/[0-9*]/ext:						extension (dovm  
</I>&gt;<i> for vm access)
</I>&gt;<i> ; /AMPUSER/&lt;ext&gt;/vmx/[busy|unavail]/[0-9*]/context:				context
</I>&gt;<i> ; /AMPUSER/&lt;ext&gt;/vmx/[busy|unavail]/[0-9*]/pri:						priority
</I>&gt;<i> ;------------------------------------------------------------------------
</I>&gt;<i> [macro-vm]
</I>&gt;<i> ; ARG1 - extension
</I>&gt;<i> ; ARG2 - DIRECTDIAL/BUSY
</I>&gt;<i> ; ARG3 - RETURN makes macro return, otherwise hangup
</I>&gt;<i> exten =&gt; s,1,Macro(user-callerid,SKIPTTL)
</I>&gt;<i> exten =&gt; s,n,Set(VMGAIN=${IF($[&quot;foo${VM_GAIN}&quot;!=&quot;foo&quot;]?&quot;g($ 
</I>&gt;<i> {VM_GAIN})&quot;:&quot;&quot;)})
</I>&gt;<i> ;
</I>&gt;<i> ; If BLKVM_OVERRIDE is set, then someone told us to block calls from  
</I>&gt;<i> going to
</I>&gt;<i> ; voicemail. This variable is reset by the answering channel so  
</I>&gt;<i> subsequent
</I>&gt;<i> ; transfers will properly function.
</I>&gt;<i> ;
</I>&gt;<i> exten =&gt; s,n,GotoIf($[&quot;foo${DB(${BLKVM_OVERRIDE})}&quot; != &quot;fooTRUE&quot;]? 
</I>&gt;<i> vmx,1)
</I>&gt;<i> ;
</I>&gt;<i> ; we didn't branch so block this from voicemail
</I>&gt;<i> ;
</I>&gt;<i> exten =&gt; s,n,Noop(CAME FROM: ${NODEST} - Blocking VM cause of key: $ 
</I>&gt;<i> {DB(BLKVM_OVERRIDE)})
</I>&gt;<i> exten =&gt; s,n,Hangup
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ; If vmx not enabled for the current mode,then jump to normal  
</I>&gt;<i> voicemail behavior
</I>&gt;<i> ; also - if not message (no-msg) is requested, straight to voicemail
</I>&gt;<i> ;
</I>&gt;<i> exten =&gt; vmx,1,GotoIf($[&quot;${ARG2}&quot;=&quot;NOMESSAGE&quot;]?s-${ARG2},1)
</I>&gt;<i> exten =&gt; vmx,n,Set(MODE=${IF($[&quot;${ARG2}&quot;=&quot;BUSY&quot;]?busy:unavail)})
</I>&gt;<i> exten =&gt; vmx,n,GotoIf($[&quot;${ARG2}&quot; != &quot;DIRECTDIAL&quot;]?notdirect)
</I>&gt;<i> exten =&gt; vmx,n,Set(MODE=${IF($[&quot;${REGEX(&quot;[b]&quot; ${VM_DDTYPE})}&quot; = &quot;1&quot;]? 
</I>&gt;<i> busy:${MODE})})
</I>&gt;<i> exten =&gt; vmx,n(notdirect),Noop(Checking if ext ${ARG1} is enabled: $ 
</I>&gt;<i> {DB(AMPUSER/${ARG1}/vmx/${MODE}/state)})
</I>&gt;<i> exten =&gt; vmx,n,GotoIf($[&quot;${DB(AMPUSER/${ARG1}/vmx/${MODE}/state)}&quot; ! 
</I>&gt;<i> = &quot;enabled&quot;]?s-${ARG2},1)
</I>&gt;<i>
</I>&gt;<i> ; If the required voicemail file does not exist, then abort and go  
</I>&gt;<i> to normal voicemail behavior
</I>&gt;<i> ;
</I>&gt;<i> ; TODO: there have been errors using System() with jump to 101 where  
</I>&gt;<i> asterisk works fine at the begining and
</I>&gt;<i> ;       then starts to jump to 101 even on success. This new mode is  
</I>&gt;<i> being tried with the SYSTEM Status which
</I>&gt;<i> ;       returns SUCCESS when the command returned succcessfully with  
</I>&gt;<i> a 0 app return code.
</I>&gt;<i> ;
</I>&gt;<i> exten =&gt; vmx,n,Macro(get-vmcontext,${ARG1})
</I>&gt;<i> ;exten =&gt; vmx,n,TrySystem(/bin/ls ${ASTSPOOLDIR}/voicemail/$ 
</I>&gt;<i> {VMCONTEXT}/${ARG1}/${MODE}.[wW][aA][vV])
</I>&gt;<i> exten =&gt; vmx,n,AGI(checksound.agi,${ASTSPOOLDIR}/voicemail/$ 
</I>&gt;<i> {VMCONTEXT}/${ARG1}/temp)
</I>&gt;<i> exten =&gt; vmx,n,GotoIf($[&quot;${SYSTEMSTATUS}&quot; = &quot;SUCCESS&quot;]?tmpgreet)
</I>&gt;<i> exten =&gt; vmx,n,AGI(checksound.agi,${ASTSPOOLDIR}/voicemail/$ 
</I>&gt;<i> {VMCONTEXT}/${ARG1}/${MODE})
</I>&gt;<i> exten =&gt; vmx,n,GotoIf($[&quot;${SYSTEMSTATUS}&quot; != &quot;SUCCESS&quot;]?nofile)
</I>&gt;<i>
</I>&gt;<i> ; Get the repeat, timeout and loop times to use if they are  
</I>&gt;<i> overriden form the global settings
</I>&gt;<i> ;
</I>&gt;<i> exten =&gt; vmx,n,Set(LOOPCOUNT=0)
</I>&gt;<i> exten =&gt; vmx,n,GotoIf($[&quot;${DB_EXISTS(AMPUSER/${ARG1}/vmx/${MODE}/ 
</I>&gt;<i> repeat)}&quot; = &quot;0&quot;]?vmxtime)
</I>&gt;<i> exten =&gt; vmx,n,Set(VMX_REPEAT=${DB_RESULT})
</I>&gt;<i> exten =&gt; vmx,n(vmxtime),GotoIf($[&quot;${DB_EXISTS(AMPUSER/${ARG1}/vmx/$ 
</I>&gt;<i> {MODE}/timeout)}&quot; = &quot;0&quot;]?vmxloops)
</I>&gt;<i> exten =&gt; vmx,n,Set(VMX_TIMEOUT=${DB_RESULT})
</I>&gt;<i> exten =&gt; vmx,n(vmxloops),GotoIf($[&quot;${DB_EXISTS(AMPUSER/${ARG1}/vmx/$ 
</I>&gt;<i> {MODE}/loops)}&quot; = &quot;0&quot;]?vmxanswer)
</I>&gt;<i> exten =&gt; vmx,n,Set(VMX_LOOPS=${DB_RESULT})
</I>&gt;<i> exten =&gt; vmx,n(vmxanswer),Answer()
</I>&gt;<i>
</I>&gt;<i> ; Now play the users voicemail recording as the basis for their ivr,  
</I>&gt;<i> the Read command will repeat as needed and if it timesout
</I>&gt;<i> ; then we go to the timeout. Otherwise handle invalid options by  
</I>&gt;<i> looping until the limit until a valid option is played.
</I>&gt;<i> ;
</I>&gt;<i> exten =&gt; vmx,n(loopstart),Read(ACTION,${ASTSPOOLDIR}/voicemail/$ 
</I>&gt;<i> {VMCONTEXT}/${ARG1}/${MODE},1,skip,${VMX_REPEAT},${VMX_TIMEOUT})
</I>&gt;<i> exten =&gt; vmx,n,GotoIf($[&quot;${EXISTS(${ACTION})}&quot; = &quot;1&quot;]?checkopt)
</I>&gt;<i>
</I>&gt;<i> ; If we are here we timed out, go to the required destination
</I>&gt;<i> ;
</I>&gt;<i> exten =&gt; vmx,n(noopt),Noop(Timeout: going to timeout dest)
</I>&gt;<i> exten =&gt; vmx,n,Set(VMX_OPTS=${VMX_OPTS_TIMEOUT})
</I>&gt;<i> exten =&gt; vmx,n,GotoIf($[&quot;${DB_EXISTS(AMPUSER/${ARG1}/vmx/${MODE}/ 
</I>&gt;<i> vmxopts/timeout)}&quot; = &quot;0&quot;]?chktime)
</I>&gt;<i> exten =&gt; vmx,n,Set(VMX_OPTS=${DB_RESULT})
</I>&gt;<i> exten =&gt; vmx,n(chktime),GotoIf($[&quot;${DB_EXISTS(AMPUSER/${ARG1}/vmx/$ 
</I>&gt;<i> {MODE}/timedest/ext)}&quot; = &quot;0&quot;]?dotime)
</I>&gt;<i> exten =&gt; vmx,n,Set(VMX_TIMEDEST_EXT=${DB_RESULT})
</I>&gt;<i> exten =&gt; vmx,n,GotoIf($[&quot;${DB_EXISTS(AMPUSER/${ARG1}/vmx/${MODE}/ 
</I>&gt;<i> timedest/context)}&quot; = &quot;0&quot;]?timepri)
</I>&gt;<i> exten =&gt; vmx,n,Set(VMX_TIMEDEST_CONTEXT=${DB_RESULT})
</I>&gt;<i> exten =&gt; vmx,n(timepri),GotoIf($[&quot;${DB_EXISTS(AMPUSER/${ARG1}/vmx/$ 
</I>&gt;<i> {MODE}/timedest/pri)}&quot; = &quot;0&quot;]?dotime)
</I>&gt;<i> exten =&gt; vmx,n,Set(VMX_TIMEDEST_PRI=${DB_RESULT})
</I>&gt;<i> exten =&gt; vmx,n(dotime),Goto(${VMX_TIMEDEST_CONTEXT},$ 
</I>&gt;<i> {VMX_TIMEDEST_EXT},${VMX_TIMEDEST_PRI})
</I>&gt;<i>
</I>&gt;<i> ; We got an option, check if the option is defined, or one of the  
</I>&gt;<i> system defaults
</I>&gt;<i> ;
</I>&gt;<i> exten =&gt; vmx,n(checkopt),GotoIf($[&quot;${DB_EXISTS(AMPUSER/${ARG1}/vmx/$ 
</I>&gt;<i> {MODE}/${ACTION}/ext)}&quot; = &quot;1&quot;]?doopt)
</I>&gt;<i> exten =&gt; vmx,n,GotoIf($[&quot;${ACTION}&quot; = &quot;0&quot;]?o,1)
</I>&gt;<i> exten =&gt; vmx,n,GotoIf($[&quot;${ACTION}&quot; = &quot;*&quot;]?adef,1)
</I>&gt;<i>
</I>&gt;<i> ; Got invalid option loop until the max
</I>&gt;<i> ;
</I>&gt;<i> exten =&gt; vmx,n,Set(LOOPCOUNT=$[${LOOPCOUNT} + 1])
</I>&gt;<i> exten =&gt; vmx,n,GotoIf($[${LOOPCOUNT} &gt; ${VMX_LOOPS}]?toomany)
</I>&gt;<i> exten =&gt; vmx,n,Playback(pm-invalid-option&amp;please-try-again)
</I>&gt;<i> exten =&gt; vmx,n,Goto(loopstart)
</I>&gt;<i>
</I>&gt;<i> ; tomany: to many invalid options, go to the specified destination
</I>&gt;<i> ;
</I>&gt;<i> exten =&gt; vmx,n(toomany),Noop(Too Many invalid entries, got to  
</I>&gt;<i> invalid dest)
</I>&gt;<i> exten =&gt; vmx,n,Set(VMX_OPTS=${VMX_OPTS_LOOPS})
</I>&gt;<i> exten =&gt; vmx,n,GotoIf($[&quot;${DB_EXISTS(AMPUSER/${ARG1}/vmx/${MODE}/ 
</I>&gt;<i> vmxopts/loops)}&quot; = &quot;0&quot;]?chkloop)
</I>&gt;<i> exten =&gt; vmx,n,Set(VMX_OPTS=${DB_RESULT})
</I>&gt;<i> exten =&gt; vmx,n(chkloop),GotoIf($[&quot;${DB_EXISTS(AMPUSER/${ARG1}/vmx/$ 
</I>&gt;<i> {MODE}/loopdest/ext)}&quot; = &quot;0&quot;]?doloop)
</I>&gt;<i> exten =&gt; vmx,n,Set(VMX_LOOPDEST_EXT=${DB_RESULT})
</I>&gt;<i> exten =&gt; vmx,n,GotoIf($[&quot;${DB_EXISTS(AMPUSER/${ARG1}/vmx/${MODE}/ 
</I>&gt;<i> loopdest/context)}&quot; = &quot;0&quot;]?looppri)
</I>&gt;<i> exten =&gt; vmx,n,Set(VMX_LOOPDEST_CONTEXT=${DB_RESULT}) ;TODO make  
</I>&gt;<i> configurable per above
</I>&gt;<i> exten =&gt; vmx,n(looppri),GotoIf($[&quot;${DB_EXISTS(AMPUSER/${ARG1}/vmx/$ 
</I>&gt;<i> {MODE}/loopdest/pri)}&quot; = &quot;0&quot;]?doloop)
</I>&gt;<i> exten =&gt; vmx,n,Set(VMX_LOOPDEST_PRI=${DB_RESULT}) ;TODO make  
</I>&gt;<i> configurable per above
</I>&gt;<i> exten =&gt; vmx,n(doloop),Goto(${VMX_LOOPDEST_CONTEXT},$ 
</I>&gt;<i> {VMX_LOOPDEST_EXT},${VMX_LOOPDEST_PRI})
</I>&gt;<i>
</I>&gt;<i> ; doopt: execute the valid option that was chosen
</I>&gt;<i> ;
</I>&gt;<i> exten =&gt; vmx,n(doopt),Noop(Got a valid option: ${DB_RESULT})
</I>&gt;<i> exten =&gt; vmx,n,Set(VMX_EXT=${DB_RESULT})
</I>&gt;<i> ;
</I>&gt;<i> ; Special case, if this option was to go to voicemail, set options  
</I>&gt;<i> and go
</I>&gt;<i> ;
</I>&gt;<i> exten =&gt; vmx,n,GotoIf($[&quot;${VMX_EXT}&quot; != &quot;dovm&quot;]?getdest)
</I>&gt;<i> exten =&gt; vmx,n(vmxopts),Set(VMX_OPTS=${VMX_OPTS_DOVM})
</I>&gt;<i> exten =&gt; vmx,n,GotoIf($[&quot;${DB_EXISTS(AMPUSER/${ARG1}/vmx/${MODE}/ 
</I>&gt;<i> vmxopts/dovm)}&quot; = &quot;0&quot;]?vmxdovm)
</I>&gt;<i> exten =&gt; vmx,n(vmxopts),Set(VMX_OPTS=${DB_RESULT})
</I>&gt;<i> exten =&gt; vmx,n(vmxdovm),goto(dovm,1)
</I>&gt;<i> ;
</I>&gt;<i> ; General case, setup the goto destination and go there (no error  
</I>&gt;<i> checking, its up to the GUI's to assure
</I>&gt;<i> ; reasonable values
</I>&gt;<i> ;
</I>&gt;<i> exten =&gt; vmx,n(getdest),GotoIf($[&quot;${DB_EXISTS(AMPUSER/${ARG1}/vmx/$ 
</I>&gt;<i> {MODE}/${ACTION}/context)}&quot; = &quot;0&quot;]?vmxpri)
</I>&gt;<i> exten =&gt; vmx,n,Set(VMX_CONTEXT=${DB_RESULT})
</I>&gt;<i> exten =&gt; vmx,n(vmxpri),GotoIf($[&quot;${DB_EXISTS(AMPUSER/${ARG1}/vmx/$ 
</I>&gt;<i> {MODE}/${ACTION}/pri)}&quot; = &quot;0&quot;]?vmxgoto)
</I>&gt;<i> exten =&gt; vmx,n,Set(VMX_PRI=${DB_RESULT})
</I>&gt;<i> exten =&gt; vmx,n(vmxgoto),Goto(${VMX_CONTEXT},${VMX_EXT},${VMX_PRI})
</I>&gt;<i>
</I>&gt;<i> ; If the required voicemail file is not present, then revert to  
</I>&gt;<i> normal voicemail
</I>&gt;<i> ; behavior treating as if it was not set
</I>&gt;<i> ;
</I>&gt;<i> exten =&gt; vmx,n(nofile),Noop(File for mode: ${MODE} does not exist,  
</I>&gt;<i> SYSTEMSTATUS: ${SYSTEMSTATUS}, going to normal voicemail)
</I>&gt;<i> exten =&gt; vmx,n,Goto(s-${ARG2},1)
</I>&gt;<i> exten =&gt; vmx,n(tmpgreet),Noop(Temporary Greeting Detected, going to  
</I>&gt;<i> normal voicemail)
</I>&gt;<i> exten =&gt; vmx,n,Goto(s-${ARG2},1)
</I>&gt;<i>
</I>&gt;<i> ; Drop into voicemail either as a direct destination (in which case  
</I>&gt;<i> VMX_OPTS might be set to something) or
</I>&gt;<i> ; if the user timed out or broke out of the loop then VMX_OPTS is  
</I>&gt;<i> always cleared such that an Allison
</I>&gt;<i> ; message is played and the caller know's what is going on.
</I>&gt;<i> ;
</I>&gt;<i> exten =&gt; dovm,1,Noop(VMX Timeout - go to voicemail)
</I>&gt;<i> exten =&gt; dovm,n,Voicemail(${ARG1}@${VMCONTEXT},${VMX_OPTS}$ 
</I>&gt;<i> {VMGAIN}) ; no flags, so allison plays please leave ...
</I>&gt;<i> exten =&gt; dovm,n,Goto(exit-${VMSTATUS},1)
</I>&gt;<i>
</I>&gt;<i> exten =&gt; s-BUSY,1,NoOp(BUSY voicemail)
</I>&gt;<i> exten =&gt; s-BUSY,n,Macro(get-vmcontext,${ARG1})
</I>&gt;<i> exten =&gt; s-BUSY,n,Voicemail(${ARG1}@${VMCONTEXT},${VM_OPTS}b$ 
</I>&gt;<i> {VMGAIN})   ; Voicemail Busy message
</I>&gt;<i> exten =&gt; s-BUSY,n,Goto(exit-${VMSTATUS},1)
</I>&gt;<i>
</I>&gt;<i> exten =&gt; s-NOMESSAGE,1,NoOp(NOMESSAGE (beeb only) voicemail)
</I>&gt;<i> exten =&gt; s-NOMESSAGE,n,Macro(get-vmcontext,${ARG1})
</I>&gt;<i> exten =&gt; s-NOMESSAGE,n,Voicemail(${ARG1}@${VMCONTEXT},s${VM_OPTS}$ 
</I>&gt;<i> {VMGAIN})
</I>&gt;<i> exten =&gt; s-NOMESSAGE,n,Goto(exit-${VMSTATUS},1)
</I>&gt;<i>
</I>&gt;<i> exten =&gt; s-DIRECTDIAL,1,NoOp(DIRECTDIAL voicemail)
</I>&gt;<i> exten =&gt; s-DIRECTDIAL,n,Macro(get-vmcontext,${ARG1})
</I>&gt;<i> exten =&gt; s-DIRECTDIAL,n,Voicemail(${ARG1}@${VMCONTEXT},${VM_OPTS}$ 
</I>&gt;<i> {VM_DDTYPE}${VMGAIN})
</I>&gt;<i> exten =&gt; s-DIRECTDIAL,n,Goto(exit-${VMSTATUS},1)
</I>&gt;<i>
</I>&gt;<i> exten =&gt; _s-.,1,Macro(get-vmcontext,${ARG1})
</I>&gt;<i> exten =&gt; _s-.,n,Voicemail(${ARG1}@${VMCONTEXT},${VM_OPTS}u$ 
</I>&gt;<i> {VMGAIN})     ; Voicemail Unavailable message
</I>&gt;<i> exten =&gt; _s-.,n,Goto(exit-${VMSTATUS},1)
</I>&gt;<i>
</I>&gt;<i> ; If the user has a 0 option defined, use that for operator zero-out  
</I>&gt;<i> from within voicemail
</I>&gt;<i> ; as well to keep it consistant with the menu structure
</I>&gt;<i> ;
</I>&gt;<i> exten =&gt; o,1,Background(one-moment-please)      ; 0 during vm  
</I>&gt;<i> message will hangup
</I>&gt;<i> exten =&gt; o,n,GotoIf($[&quot;${DB_EXISTS(AMPUSER/${ARG1}/vmx/${MODE}/0/ 
</I>&gt;<i> ext)}&quot; = &quot;0&quot;]?doopdef)
</I>&gt;<i>
</I>&gt;<i> exten =&gt; o,n,Set(VMX_OPDEST_EXT=${DB_RESULT})
</I>&gt;<i> exten =&gt; o,n,GotoIf($[&quot;${DB_EXISTS(AMPUSER/${ARG1}/vmx/${MODE}/0/ 
</I>&gt;<i> context)}&quot; = &quot;1&quot;]?opcontext)
</I>&gt;<i> exten =&gt; o,n,Set(DB_RESULT=${VMX_CONTEXT})
</I>&gt;<i> exten =&gt; o,n(opcontext),Set(VMX_OPDEST_CONTEXT=${DB_RESULT})
</I>&gt;<i> exten =&gt; o,n,GotoIf($[&quot;${DB_EXISTS(AMPUSER/${ARG1}/vmx/${MODE}/0/ 
</I>&gt;<i> pri)}&quot; = &quot;1&quot;]?oppri)
</I>&gt;<i> exten =&gt; o,n,Set(DB_RESULT=${VMX_PRI})
</I>&gt;<i> exten =&gt; o,n(oppri),Set(VMX_OPDEST_PRI=${DB_RESULT})
</I>&gt;<i>
</I>&gt;<i> exten =&gt; o,n,Goto(${VMX_OPDEST_CONTEXT},${VMX_OPDEST_EXT},$ 
</I>&gt;<i> {VMX_OPDEST_PRI})
</I>&gt;<i> exten =&gt; o,n(doopdef),GotoIf($[&quot;x${OPERATOR_XTN}&quot;=&quot;x&quot;]?nooper:from- 
</I>&gt;<i> internal,${OPERATOR_XTN},1)
</I>&gt;<i> exten =&gt; o,n(nooper),GotoIf($[&quot;x${FROM_DID}&quot;=&quot;x&quot;]?nodid)
</I>&gt;<i> exten =&gt; o,n,Dial(Local/${FROM_DID}@from-pstn)
</I>&gt;<i> exten =&gt; o,n,Macro(hangup)
</I>&gt;<i> exten =&gt; o,n(nodid),Dial(Local/<A HREF="https://lists.berlios.de/mailman/listinfo/chan-sccp-users">s at from-pstn</A>)
</I>&gt;<i> exten =&gt; o,n,Macro(hangup)
</I>&gt;<i>
</I>&gt;<i> ; If the user has a * option defined, use that for the * out from  
</I>&gt;<i> within voicemail
</I>&gt;<i> ; as well to keep it consistant with the menu structure
</I>&gt;<i> ;
</I>&gt;<i> exten =&gt; a,1,Macro(get-vmcontext,${ARG1})
</I>&gt;<i> exten =&gt; a,n,GotoIf($[&quot;${DB_EXISTS(AMPUSER/${ARG1}/vmx/${MODE}/*/ 
</I>&gt;<i> ext)}&quot; = &quot;0&quot;]?adef,1)
</I>&gt;<i>
</I>&gt;<i> exten =&gt; a,n,Set(VMX_ADEST_EXT=${DB_RESULT})
</I>&gt;<i> exten =&gt; a,n,GotoIf($[&quot;${DB_EXISTS(AMPUSER/${ARG1}/vmx/${MODE}/*/ 
</I>&gt;<i> context)}&quot; = &quot;1&quot;]?acontext)
</I>&gt;<i> exten =&gt; a,n,Set(DB_RESULT=${VMX_CONTEXT})
</I>&gt;<i> exten =&gt; a,n(acontext),Set(VMX_ADEST_CONTEXT=${DB_RESULT})
</I>&gt;<i> exten =&gt; a,n,GotoIf($[&quot;${DB_EXISTS(AMPUSER/${ARG1}/vmx/${MODE}/*/ 
</I>&gt;<i> pri)}&quot; = &quot;1&quot;]?apri)
</I>&gt;<i> exten =&gt; a,n,Set(DB_RESULT=${VMX_PRI})
</I>&gt;<i> exten =&gt; a,n(apri),Set(VMX_ADEST_PRI=${DB_RESULT})
</I>&gt;<i> exten =&gt; a,n,Goto(${VMX_ADEST_CONTEXT},${VMX_ADEST_EXT},$ 
</I>&gt;<i> {VMX_ADEST_PRI})
</I>&gt;<i>
</I>&gt;<i> exten =&gt; adef,1,VoiceMailMain(${ARG1}@${VMCONTEXT})
</I>&gt;<i> exten =&gt; adef,n,GotoIf($[&quot;${ARG3}&quot; = &quot;RETURN&quot;]?exit-RETURN,1)
</I>&gt;<i> exten =&gt; adef,n,Hangup
</I>&gt;<i>
</I>&gt;<i> exten =&gt; exit-FAILED,1,Playback(im-sorry&amp;an-error-has-occured)
</I>&gt;<i> exten =&gt; exit-FAILED,n,GotoIf($[&quot;${ARG3}&quot; = &quot;RETURN&quot;]?exit-RETURN,1)
</I>&gt;<i> exten =&gt; exit-FAILED,n,Hangup()
</I>&gt;<i>
</I>&gt;<i> exten =&gt; exit-SUCCESS,1,GotoIf($[&quot;${ARG3}&quot; = &quot;RETURN&quot;]?exit-RETURN,1)
</I>&gt;<i> exten =&gt; exit-SUCCESS,n,Playback(goodbye)
</I>&gt;<i> exten =&gt; exit-SUCCESS,n,Hangup()
</I>&gt;<i>
</I>&gt;<i> exten =&gt; exit-USEREXIT,1,GotoIf($[&quot;${ARG3}&quot; = &quot;RETURN&quot;]?exit-RETURN,1)
</I>&gt;<i> exten =&gt; exit-USEREXIT,n,Playback(goodbye)
</I>&gt;<i> exten =&gt; exit-USEREXIT,n,Hangup()
</I>&gt;<i>
</I>&gt;<i> exten =&gt; exit-RETURN,1,Noop(Returning From Voicemail because macro)
</I>&gt;<i>
</I>&gt;<i> exten =&gt; t,1,Hangup()
</I>&gt;<i> ;------------------------------------------------------------------------
</I>&gt;<i>
</I>&gt;<i> ;------------------------------------------------------------------------
</I>&gt;<i> ; [macro-simple-dial]
</I>&gt;<i> ;------------------------------------------------------------------------
</I>&gt;<i> ; This macro was derived from macro-exten-vm, which is what is  
</I>&gt;<i> normally used to
</I>&gt;<i> ; ring an extension. It has been simplified and designed to never go  
</I>&gt;<i> to voicemail
</I>&gt;<i> ; and always return regardless of the DIALSTATUS for any incomplete  
</I>&gt;<i> call.
</I>&gt;<i> ;
</I>&gt;<i> ; It's current primary purpose is to allow findmefollow ring an  
</I>&gt;<i> extension prior
</I>&gt;<i> ; to trying the follow-me ringgroup that is provided.
</I>&gt;<i> ;
</I>&gt;<i> ; Ring an extension, if the extension is busy or there is no answer,  
</I>&gt;<i> return
</I>&gt;<i> ; ARGS: $EXTENSION, $RINGTIME
</I>&gt;<i> ;------------------------------------------------------------------------
</I>&gt;<i> [macro-simple-dial]
</I>&gt;<i> exten =&gt; s,1,Set(EXTTOCALL=${ARG1})
</I>&gt;<i> exten =&gt; s,n,Set(RT=${ARG2})
</I>&gt;<i> exten =&gt; s,n,Set(CFUEXT=${DB(CFU/${EXTTOCALL})})
</I>&gt;<i> exten =&gt; s,n,Set(CFBEXT=${DB(CFB/${EXTTOCALL})})
</I>&gt;<i>
</I>&gt;<i> exten =&gt; s,n,Macro(dial,${RT},${DIAL_OPTIONS},${EXTTOCALL})
</I>&gt;<i>
</I>&gt;<i> exten =&gt; s,n,Set(PR_DIALSTATUS=${DIALSTATUS})
</I>&gt;<i>
</I>&gt;<i> ; if we return, thus no answer, and they have a CFU setting, then   
</I>&gt;<i> we try that next
</I>&gt;<i> ;
</I>&gt;<i> exten =&gt; s,n,GosubIf($[$[&quot;${PR_DIALSTATUS}&quot;=&quot;NOANSWER&quot;] &amp; $[&quot;foo$ 
</I>&gt;<i> {CFUEXT}&quot;!=&quot;foo&quot;]]?docfu,1) ; check for CFU in use on no answer
</I>&gt;<i> exten =&gt; s,n,GosubIf($[$[&quot;${PR_DIALSTATUS}&quot;=&quot;BUSY&quot;] &amp; $[&quot;foo$ 
</I>&gt;<i> {CFBEXT}&quot;!=&quot;foo&quot;]]?docfb,1) ; check for CFB in use on busy
</I>&gt;<i> exten =&gt; s,n,Set(DIALSTATUS=${PR_DIALSTATUS})
</I>&gt;<i>
</I>&gt;<i> ; Nothing yet, then go to the end (which will just return, but in  
</I>&gt;<i> case we decide to do something with certain
</I>&gt;<i> ; return situations, this is left in.
</I>&gt;<i> ;
</I>&gt;<i> exten =&gt; s,n,Goto(s-${DIALSTATUS},1)
</I>&gt;<i>
</I>&gt;<i> ; Try the Call Forward on No Answer / Unavailable number.
</I>&gt;<i> ; We want to try CFU if set, but we want the same ring timer as was  
</I>&gt;<i> set to our call (or do we want the
</I>&gt;<i> ; system ringtimer? - probably not). Then if no answer there  
</I>&gt;<i> (assuming it doesn't drop into their vm or
</I>&gt;<i> ; something we return, which will have the net effect of returning  
</I>&gt;<i> to the followme setup.)
</I>&gt;<i> ;
</I>&gt;<i> ; want to avoid going to other follow-me settings here. So check if  
</I>&gt;<i> the CFUEXT is a user and if it is
</I>&gt;<i> ; then direct it straight to ext-local (to avoid getting intercepted  
</I>&gt;<i> by findmefollow) otherwise send it
</I>&gt;<i> ; to from-internal since it may be an outside line.
</I>&gt;<i> ;
</I>&gt;<i> exten =&gt; docfu,1,GotoIf( $[ &quot;foo${DB(AMPUSER/${CFUEXT}/device)}&quot; =  
</I>&gt;<i> &quot;foo&quot; ]?chlocal)
</I>&gt;<i> exten =&gt; docfu,n,Dial(Local/${CFUEXT}@ext-local,${RT},${DIAL_OPTIONS})
</I>&gt;<i> exten =&gt; docfu,n,Return
</I>&gt;<i> exten =&gt; docfu,n(chlocal),Dial(Local/${CFUEXT}@from-internal/n,${RT}, 
</I>&gt;<i> ${DIAL_OPTIONS})
</I>&gt;<i> exten =&gt; docfu,n,Return
</I>&gt;<i>
</I>&gt;<i> ; Try the Call Forward on Busy number
</I>&gt;<i> exten =&gt; docfb,1,GotoIf( $[ &quot;foo${DB(AMPUSER/${CFBEXT}/device)}&quot; =  
</I>&gt;<i> &quot;foo&quot; ]?chlocal)
</I>&gt;<i> exten =&gt; docfb,n,Dial(Local/${CFBEXT}@ext-local,${RT},${DIAL_OPTIONS})
</I>&gt;<i> exten =&gt; docfb,n,Return
</I>&gt;<i> exten =&gt; docfb,n(chlocal),Dial(Local/${CFBEXT}@from-internal/n,${RT}, 
</I>&gt;<i> ${DIAL_OPTIONS})
</I>&gt;<i> exten =&gt; docfb,n,Return
</I>&gt;<i>
</I>&gt;<i> ; In all cases of no connection, come here and simply return, since  
</I>&gt;<i> the calling dialplan will
</I>&gt;<i> ; decide what to do next
</I>&gt;<i> exten =&gt; _s-.,1,NoOp(Extension is reporting ${EXTEN})
</I>&gt;<i> ;------------------------------------------------------------------------
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ; get the voicemail context for the user in ARG1
</I>&gt;<i> [macro-get-vmcontext]
</I>&gt;<i> exten =&gt; s,1,Set(VMCONTEXT=${DB(AMPUSER/${ARG1}/voicemail)})
</I>&gt;<i> exten =&gt; s,2,GotoIf($[&quot;foo${VMCONTEXT}&quot; = &quot;foo&quot;]?200:300)
</I>&gt;<i> exten =&gt; s,200,Set(VMCONTEXT=default)
</I>&gt;<i> exten =&gt; s,300,NoOp()
</I>&gt;<i>
</I>&gt;<i> ; For some reason, if I don't run setCIDname, CALLERID(name) will be  
</I>&gt;<i> blank in my AGI
</I>&gt;<i> ; ARGS: none
</I>&gt;<i> [macro-fixcid]
</I>&gt;<i> exten =&gt; s,1,Set(CALLERID(name)=${CALLERID(name)})
</I>&gt;<i>
</I>&gt;<i> ; Ring groups of phones
</I>&gt;<i> ; ARGS: comma separated extension list
</I>&gt;<i> ; 1 - Ring Group Strategy
</I>&gt;<i> ; 2 - ringtimer
</I>&gt;<i> ; 3 - prefix
</I>&gt;<i> ; 4 - extension list
</I>&gt;<i> [macro-rg-group]
</I>&gt;<i> exten =&gt; s,1,Macro(user-callerid,SKIPTTL) ; already called from  
</I>&gt;<i> ringgroup
</I>&gt;<i> exten =&gt; s,2,GotoIf($[&quot;${CALLERID(name):0:${LEN(${RGPREFIX})}}&quot; != &quot;$ 
</I>&gt;<i> {RGPREFIX}&quot;]?4:3)  ; check for old prefix
</I>&gt;<i> exten =&gt; s,3,Set(CALLERID(name)=${CALLERID(name):${LEN($ 
</I>&gt;<i> {RGPREFIX})}}) ; strip off old prefix
</I>&gt;<i> exten =&gt; s,4,Set(RGPREFIX=${ARG3})  ; set new prefix
</I>&gt;<i> exten =&gt; s,5,Set(CALLERID(name)=${RGPREFIX}${CALLERID(name)})  ; add  
</I>&gt;<i> prefix to callerid name
</I>&gt;<i> exten =&gt; s,6,Set(RecordMethod=Group)  ; set new prefix
</I>&gt;<i> exten =&gt; s,7,Macro(record-enable,${MACRO_EXTEN},${RecordMethod})
</I>&gt;<i> exten =&gt; s,8,Set(RingGroupMethod=${ARG1})     ;
</I>&gt;<i> exten =&gt; s,9,Macro(dial,${ARG2},${DIAL_OPTIONS},${ARG4})
</I>&gt;<i> exten =&gt; s,10,Set(RingGroupMethod='')     ;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ;
</I>&gt;<i> ; Outgoing channel(s) are busy ... inform the client
</I>&gt;<i> ; but use noanswer features like ringgroups don't break by being  
</I>&gt;<i> answered
</I>&gt;<i> ; just to play the message.
</I>&gt;<i> ;
</I>&gt;<i> [macro-outisbusy]
</I>&gt;<i> exten =&gt; s,1,Playback(all-circuits-busy-now,noanswer)
</I>&gt;<i> exten =&gt; s,n,Playback(pls-try-call-later,noanswer)
</I>&gt;<i> exten =&gt; s,n,Macro(hangupcall)
</I>&gt;<i>
</I>&gt;<i> ; What to do on hangup.
</I>&gt;<i> [macro-hangupcall]
</I>&gt;<i> exten =&gt; s,1,ResetCDR(w)
</I>&gt;<i> exten =&gt; s,n,NoCDR()
</I>&gt;<i>
</I>&gt;<i> ; Cleanup any remaining RG flag
</I>&gt;<i> ;
</I>&gt;<i> exten =&gt; s,n,GotoIf($[ &quot;x${USE_CONFIRMATION}&quot; = &quot;x&quot; | &quot;x$ 
</I>&gt;<i> {RINGGROUP_INDEX}&quot; = &quot;x&quot; | &quot;${CHANNEL}&quot; != &quot;${UNIQCHAN}&quot;]?skiprg)
</I>&gt;<i> exten =&gt; s,n,Noop(Cleaning Up Confirmation Flag: RG/$ 
</I>&gt;<i> {RINGGROUP_INDEX}/${CHANNEL})
</I>&gt;<i> exten =&gt; s,n,DBDel(RG/${RINGGROUP_INDEX}/${CHANNEL})
</I>&gt;<i>
</I>&gt;<i> ; Cleanup any remaining BLKVM flag
</I>&gt;<i> ;
</I>&gt;<i> exten =&gt; s,n(skiprg),GotoIf($[ &quot;x${BLKVM_BASE}&quot; = &quot;x&quot; | &quot;BLKVM/$ 
</I>&gt;<i> {BLKVM_BASE}/${CHANNEL}&quot; != &quot;${BLKVM_OVERRIDE}&quot; ]?skipblkvm)
</I>&gt;<i> exten =&gt; s,n,Noop(Cleaning Up Block VM Flag: ${BLKVM_OVERRIDE})
</I>&gt;<i> exten =&gt; s,n,DBDel(${BLKVM_OVERRIDE})
</I>&gt;<i>
</I>&gt;<i> ; Cleanup any remaining FollowMe DND flags
</I>&gt;<i> ;
</I>&gt;<i> exten =&gt; s,n(skipblkvm),GotoIf($[ &quot;x${FMGRP}&quot; = &quot;x&quot; | &quot;x${FMUNIQUE}&quot;  
</I>&gt;<i> = &quot;x&quot; | &quot;${CHANNEL}&quot; != &quot;${FMUNIQUE}&quot; ]?theend)
</I>&gt;<i> exten =&gt; s,n,DBDel(FM/DND/${FMGRP}/${CHANNEL})
</I>&gt;<i>
</I>&gt;<i> exten =&gt; s,n(theend),Hangup
</I>&gt;<i>
</I>&gt;<i> [macro-faxreceive]
</I>&gt;<i> exten =&gt; s,1,Set(FAXFILE=${ASTSPOOLDIR}/fax/${UNIQUEID}.tif)
</I>&gt;<i> exten =&gt; s,2,Set(EMAILADDR=${FAX_RX_EMAIL})
</I>&gt;<i> exten =&gt; s,3,rxfax(${FAXFILE})
</I>&gt;<i> exten =&gt; s,103,Set(EMAILADDR=${FAX_RX_EMAIL})
</I>&gt;<i> exten =&gt; s,104,Goto(3)
</I>&gt;<i>
</I>&gt;<i> ; dialout and strip the prefix
</I>&gt;<i> [macro-dialout]
</I>&gt;<i> exten =&gt; s,1,Macro(user-callerid,SKIPTTL)
</I>&gt;<i> exten =&gt; s,2,GotoIf($[&quot;${ECID${CALLERID(number)}}&quot; = &quot;&quot;]?5) 	;check  
</I>&gt;<i> for CID override for exten
</I>&gt;<i> exten =&gt; s,3,Set(CALLERID(all)=${ECID${CALLERID(number)}})
</I>&gt;<i> exten =&gt; s,4,Goto(7)
</I>&gt;<i> exten =&gt; s,5,GotoIf($[&quot;${OUTCID_${ARG1}}&quot; = &quot;&quot;]?7) 		;check for CID  
</I>&gt;<i> override for trunk
</I>&gt;<i> exten =&gt; s,6,Set(CALLERID(all)=${OUTCID_${ARG1}})
</I>&gt;<i> exten =&gt; s,7,Set(length=${LEN(${DIAL_OUT_${ARG1}})})
</I>&gt;<i> exten =&gt; s,8,Dial(${OUT_${ARG1}}/${ARG2:${length}})
</I>&gt;<i> exten =&gt; s,9,Playtones(congestion)
</I>&gt;<i> exten =&gt; s,10,Congestion(5)
</I>&gt;<i> exten =&gt; s,109,Macro(outisbusy)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ; dialout using default OUT trunk - no prefix
</I>&gt;<i> [macro-dialout-default]
</I>&gt;<i> exten =&gt; s,1,Macro(user-callerid,SKIPTTL)
</I>&gt;<i> exten =&gt; s,2,Macro(record-enable,${CALLERID(number)},OUT)
</I>&gt;<i> exten =&gt; s,3,Macro(outbound-callerid,${ARG1})
</I>&gt;<i> exten =&gt; s,4,Dial(${OUT}/${ARG1})
</I>&gt;<i> exten =&gt; s,5,Playtones(congestion)
</I>&gt;<i> exten =&gt; s,6,Congestion(5)
</I>&gt;<i> exten =&gt; s,105,Macro(outisbusy)
</I>&gt;<i>
</I>&gt;<i> [macro-dialout-trunk-predial-hook]
</I>&gt;<i> ; this macro intentially left blank so it may be safely overwritten  
</I>&gt;<i> for any custom
</I>&gt;<i> ; requirements that an installation may have.
</I>&gt;<i> ;
</I>&gt;<i> ; MACRO RETURN CODE: ${PREDIAL_HOOK_RET}
</I>&gt;<i> ;                    if set to &quot;BYPASS&quot; then this trunk will be  
</I>&gt;<i> skipped
</I>&gt;<i> ;
</I>&gt;<i> exten =&gt; s,1,MacroExit()
</I>&gt;<i>
</I>&gt;<i> ; This macro is for dev purposes and just dumps channel/app  
</I>&gt;<i> variables.  Useful when designing new contexts.
</I>&gt;<i> [macro-dumpvars]
</I>&gt;<i> exten =&gt; s,1,Noop(ACCOUNTCODE=${ACCOUNTCODE})
</I>&gt;<i> exten =&gt; s,2,Noop(ANSWEREDTIME=${ANSWEREDTIME})
</I>&gt;<i> exten =&gt; s,3,Noop(BLINDTRANSFER=${BLINDTRANSFER})
</I>&gt;<i> exten =&gt; s,4,Noop(CALLERID=${CALLERID(all)})
</I>&gt;<i> exten =&gt; s,5,Noop(CALLERID(name)=${CALLERID(name)})
</I>&gt;<i> exten =&gt; s,6,Noop(CALLERID(number)=${CALLERID(number)})
</I>&gt;<i> exten =&gt; s,7,Noop(CALLINGPRES=${CALLINGPRES})
</I>&gt;<i> exten =&gt; s,8,Noop(CHANNEL=${CHANNEL})
</I>&gt;<i> exten =&gt; s,9,Noop(CONTEXT=${CONTEXT})
</I>&gt;<i> exten =&gt; s,10,Noop(DATETIME=${DATETIME})
</I>&gt;<i> exten =&gt; s,11,Noop(DIALEDPEERNAME=${DIALEDPEERNAME})
</I>&gt;<i> exten =&gt; s,12,Noop(DIALEDPEERNUMBER=${DIALEDPEERNUMBER})
</I>&gt;<i> exten =&gt; s,13,Noop(DIALEDTIME=${DIALEDTIME})
</I>&gt;<i> exten =&gt; s,14,Noop(DIALSTATUS=${DIALSTATUS})
</I>&gt;<i> exten =&gt; s,15,Noop(DNID=${DNID})
</I>&gt;<i> exten =&gt; s,16,Noop(EPOCH=${EPOCH})
</I>&gt;<i> exten =&gt; s,17,Noop(EXTEN=${EXTEN})
</I>&gt;<i> exten =&gt; s,18,Noop(HANGUPCAUSE=${HANGUPCAUSE})
</I>&gt;<i> exten =&gt; s,19,Noop(INVALID_EXTEN=${INVALID_EXTEN})
</I>&gt;<i> exten =&gt; s,20,Noop(LANGUAGE=${LANGUAGE})
</I>&gt;<i> exten =&gt; s,21,Noop(MEETMESECS=${MEETMESECS})
</I>&gt;<i> exten =&gt; s,22,Noop(PRIORITY=${PRIORITY})
</I>&gt;<i> exten =&gt; s,23,Noop(RDNIS=${RDNIS})
</I>&gt;<i> exten =&gt; s,24,Noop(SIPDOMAIN=${SIPDOMAIN})
</I>&gt;<i> exten =&gt; s,25,Noop(SIP_CODEC=${SIP_CODEC})
</I>&gt;<i> exten =&gt; s,26,Noop(SIPCALLID=${SIPCALLID})
</I>&gt;<i> exten =&gt; s,27,Noop(SIPUSERAGENT=${SIPUSERAGENT})
</I>&gt;<i> exten =&gt; s,29,Noop(TXTCIDNAME=${TXTCIDNAME})
</I>&gt;<i> exten =&gt; s,30,Noop(UNIQUEID=${UNIQUEID})
</I>&gt;<i> exten =&gt; s,31,Noop(TOUCH_MONITOR=${TOUCH_MONITOR})
</I>&gt;<i> exten =&gt; s,32,Noop(MACRO_CONTEXT=${MACRO_CONTEXT})
</I>&gt;<i> exten =&gt; s,33,Noop(MACRO_EXTEN=${MACRO_EXTEN})
</I>&gt;<i> exten =&gt; s,34,Noop(MACRO_PRIORITY=${MACRO_PRIORITY})
</I>&gt;<i>
</I>&gt;<i> [macro-user-logon]
</I>&gt;<i> ; check device type
</I>&gt;<i> ;
</I>&gt;<i> exten =&gt; s,1,Set(DEVICETYPE=${DB(DEVICE/${CALLERID(number)}/type)})
</I>&gt;<i> exten =&gt; s,n,Answer()
</I>&gt;<i> exten =&gt; s,n,Wait(1)
</I>&gt;<i> exten =&gt; s,n,GotoIf($[&quot;${DEVICETYPE}&quot; = &quot;fixed&quot;]?s-FIXED,1)
</I>&gt;<i> ; get user's extension
</I>&gt;<i> ;
</I>&gt;<i> exten =&gt; s,n,Set(AMPUSER=${ARG1})
</I>&gt;<i> exten =&gt; s,n,GotoIf($[&quot;${AMPUSER}&quot; != &quot;&quot;]?gotpass)
</I>&gt;<i> exten =&gt; s,n(playagain),Read(AMPUSER,please-enter-your-extension- 
</I>&gt;<i> then-press-pound,,,4)
</I>&gt;<i> ; get user's password and authenticate
</I>&gt;<i> ;
</I>&gt;<i> exten =&gt; s,n,GotoIf($[&quot;${AMPUSER}&quot; = &quot;&quot;]?s-MAXATTEMPTS,1)
</I>&gt;<i> exten =&gt; s,n(gotpass),GotoIf($[&quot;${DB_EXISTS(AMPUSER/${AMPUSER}/ 
</I>&gt;<i> password)}&quot; = &quot;0&quot;]?s-NOUSER,1)
</I>&gt;<i> exten =&gt; s,n,Set(AMPUSERPASS=${DB_RESULT})
</I>&gt;<i> exten =&gt; s,n,GotoIf($[${LEN(${AMPUSERPASS})} = 0]?s-NOPASSWORD,1)
</I>&gt;<i> ; do not continue if the user has already logged onto this device
</I>&gt;<i> ;
</I>&gt;<i> exten =&gt; s,n,Set(DEVICEUSER=${DB(DEVICE/${CALLERID(number)}/user)})
</I>&gt;<i> exten =&gt; s,n,GotoIf($[&quot;${DEVICEUSER}&quot; = &quot;${AMPUSER}&quot;]?s- 
</I>&gt;<i> ALREADYLOGGEDON,1)
</I>&gt;<i> exten =&gt; s,n,Authenticate(${AMPUSERPASS})
</I>&gt;<i> exten =&gt; s,n,DeadAGI(user_login_out.agi,login,${CALLERID(number)},$ 
</I>&gt;<i> {AMPUSER})
</I>&gt;<i> exten =&gt; s,n,Playback(vm-goodbye)
</I>&gt;<i>
</I>&gt;<i> exten =&gt; s-FIXED,1,NoOp(Device is FIXED and cannot be logged into)
</I>&gt;<i> exten =&gt; s-FIXED,n,Playback(ha/phone)
</I>&gt;<i> exten =&gt; s-FIXED,n,SayDigits(${CALLERID(number)})
</I>&gt;<i> exten =&gt; s-FIXED,n,Playback(is-curntly-unavail&amp;vm-goodbye)
</I>&gt;<i> exten =&gt; s-FIXED,n,Hangup ;TODO should play msg indicated device  
</I>&gt;<i> cannot be logged into
</I>&gt;<i>
</I>&gt;<i> exten =&gt; s-ALREADYLOGGEDON,1,NoOp(This device has already been  
</I>&gt;<i> logged into by this user)
</I>&gt;<i> exten =&gt; s-ALREADYLOGGEDON,n,Playback(vm-goodbye)
</I>&gt;<i> exten =&gt; s-ALREADYLOGGEDON,n,Hangup ;TODO should play msg indicated  
</I>&gt;<i> device is already logged into
</I>&gt;<i>
</I>&gt;<i> exten =&gt; s-NOPASSWORD,1,NoOp(This extension does not exist or no  
</I>&gt;<i> password is set)
</I>&gt;<i> exten =&gt; s-NOPASSWORD,n,Playback(pbx-invalid)
</I>&gt;<i> exten =&gt; s-NOPASSWORD,n,Goto(s,playagain)
</I>&gt;<i>
</I>&gt;<i> exten =&gt; s-MAXATTEMPTS,1,NoOp(Too many login attempts)
</I>&gt;<i> exten =&gt; s-MAXATTEMPTS,n,Playback(vm-goodbye)
</I>&gt;<i> exten =&gt; s-MAXATTEMPTS,n,Hangup
</I>&gt;<i>
</I>&gt;<i> exten =&gt; s-NOUSER,1,NoOp(Invalid extension ${AMPUSER} entered)
</I>&gt;<i> exten =&gt; s-NOUSER,n,Playback(pbx-invalid)
</I>&gt;<i> exten =&gt; s-NOUSER,n,Goto(s,playagain)
</I>&gt;<i>
</I>&gt;<i> [macro-user-logoff]
</I>&gt;<i> ; check device type
</I>&gt;<i> ;
</I>&gt;<i> exten =&gt; s,1,Set(DEVICETYPE=${DB(DEVICE/${CALLERID(number)}/type)})
</I>&gt;<i> exten =&gt; s,n,GotoIf($[&quot;${DEVICETYPE}&quot; = &quot;fixed&quot;]?s-FIXED,1)
</I>&gt;<i> exten =&gt; s,n,DeadAGI(user_login_out.agi,logout,${CALLERID(number)})
</I>&gt;<i> exten =&gt; s,n(done),Playback(vm-goodbye)
</I>&gt;<i>
</I>&gt;<i> exten =&gt; s-FIXED,1,NoOp(Device is FIXED and cannot be logged out of)
</I>&gt;<i> exten =&gt; s-FIXED,n,Playback(an-error-has-occured&amp;vm-goodbye)
</I>&gt;<i> exten =&gt; s-FIXED,n,Hangup ;TODO should play msg indicated device  
</I>&gt;<i> cannot be logged into
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ; Privacy Manager Macro makes sure that any calls that don't pass  
</I>&gt;<i> the privacy manager are presented
</I>&gt;<i> ; with congestion since there have been observed cases of the call  
</I>&gt;<i> continuing if not stopped with a
</I>&gt;<i> ; congestion, and this provides a slightly more friendly 'sorry'  
</I>&gt;<i> message in case the user is
</I>&gt;<i> ; legitamately trying to be cooperative.
</I>&gt;<i> ;
</I>&gt;<i> ; Note: the following options are configurable in privacy.conf:
</I>&gt;<i> ;
</I>&gt;<i> ;	maxretries = 3 ; default value, number of retries before failing
</I>&gt;<i> ;	minlength = 10 ; default value, number of digits to be accepted as  
</I>&gt;<i> valid CID
</I>&gt;<i> ;
</I>&gt;<i> [macro-privacy-mgr]
</I>&gt;<i> exten =&gt; s,1,Set(KEEPCID=${CALLERID(num)})
</I>&gt;<i> exten =&gt; s,n,GotoIf($[&quot;foo${CALLERID(num):0:1}&quot;=&quot;foo+&quot;]? 
</I>&gt;<i> CIDTEST2:CIDTEST1)
</I>&gt;<i> exten =&gt; s,n(CIDTEST1),Set(TESTCID=${MATH(1+${CALLERID(num)})})
</I>&gt;<i> exten =&gt; s,n,Goto(TESTRESULT)
</I>&gt;<i> exten =&gt; s,n(CIDTEST2),Set(TESTCID=${MATH(1+${CALLERID(num):1})})
</I>&gt;<i> exten =&gt; s,n(TESTRESULT),GotoIf($[&quot;foo${TESTCID}&quot;=&quot;foo&quot;]? 
</I>&gt;<i> CLEARCID:PRIVMGR)
</I>&gt;<i> exten =&gt; s,n(CLEARCID),Set(CALLERID(num)=)
</I>&gt;<i> exten =&gt; s,n(PRIVMGR),PrivacyManager()
</I>&gt;<i> exten =&gt; s,n,GotoIf($[&quot;${PRIVACYMGRSTATUS}&quot;=&quot;FAILED&quot;]?fail)
</I>&gt;<i> exten =&gt; s,n,SetCallerPres(allowed_passed_screen); stop gap until  
</I>&gt;<i> app_privacy.c clears unavailble bit
</I>&gt;<i> exten =&gt; s,PRIVMGR+101(fail),Noop(STATUS: ${PRIVACYMGRSTATUS} CID: $ 
</I>&gt;<i> {CALLERID(num)} ${CALLERID(name)} CALLPRES: ${CALLLINGPRES})
</I>&gt;<i> exten =&gt; s,n,Playback(sorry-youre-having-problems)
</I>&gt;<i> exten =&gt; s,n,Playback(goodbye)
</I>&gt;<i> exten =&gt; s,n,Playtones(congestion)
</I>&gt;<i> exten =&gt; s,n,Congestion(5)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ; Text-To-Speech related macros
</I>&gt;<i> ; These all follow common actions.  First try to playback a file  
</I>&gt;<i> &quot;tts/custom-md5&quot;
</I>&gt;<i> ; where &quot;md5&quot; is the md5() of whatever is going to be played. If  
</I>&gt;<i> that doesn't exist,
</I>&gt;<i> ; try to playback using macro-tts-sayXXXXX (where XXXXX is text/ 
</I>&gt;<i> digits/etc, same as
</I>&gt;<i> ; the macro below). If that macro exits with MACRO_OFFSET=100, then  
</I>&gt;<i> it's done,
</I>&gt;<i> ; therwise, fallback to the default asterisk method.
</I>&gt;<i> ;
</I>&gt;<i> ; say text is purely for text-to-speech, there is no fallback
</I>&gt;<i> [macro-saytext]
</I>&gt;<i> exten =&gt; s,1,Noop(Trying custom SayText playback for &quot;${ARG1}&quot;)
</I>&gt;<i> exten =&gt; s,n,Playback(tts/custom-${MD5(${ARG1})})
</I>&gt;<i> exten =&gt; s,n,GotoIf($[&quot;${PLAYBACKSTATUS}&quot;=&quot;SUCCESS&quot;]?done)
</I>&gt;<i> ; call tts-saytext. This should set MACRO_OFFSET=101 if it was  
</I>&gt;<i> successful
</I>&gt;<i> exten =&gt; s,n(tts),Macro(tts-saytext,${ARG1},${ARG2},${ARG3})
</I>&gt;<i> exten =&gt; s,n,Noop(No text-to-speech handler for SayText, cannot say  
</I>&gt;<i> &quot;${ARG1}&quot;)
</I>&gt;<i> exten =&gt; s,n,Goto(done)
</I>&gt;<i> exten =&gt; s,tts+101,Noop(tts handled saytext)
</I>&gt;<i>
</I>&gt;<i> ; say name is for saying names typically, but fallsback to using  
</I>&gt;<i> SayAlpha
</I>&gt;<i> ; (saying the word letter-by-letter)
</I>&gt;<i> [macro-sayname]
</I>&gt;<i> exten =&gt; s,1,Noop(Trying custom SayName playback for &quot;${ARG1}&quot;)
</I>&gt;<i> exten =&gt; s,n,Playback(tts/custom-${MD5(${ARG1})})
</I>&gt;<i> exten =&gt; s,n,GotoIf($[&quot;${PLAYBACKSTATUS}&quot;=&quot;SUCCESS&quot;]?done)
</I>&gt;<i> ; call tts-sayalpha. This should set MACRO_OFFSET=101 if it was  
</I>&gt;<i> successful
</I>&gt;<i> exten =&gt; s,n(tts),Macro(tts-sayalpha,${ARG1},${ARG2},${ARG3})
</I>&gt;<i> exten =&gt; s,n,SayAlpha(${ARG1})
</I>&gt;<i> exten =&gt; s,n,Goto(done)
</I>&gt;<i> exten =&gt; s,tts+101,Noop(tts handled sayname)
</I>&gt;<i>
</I>&gt;<i> ; Say number is for saying numbers (eg &quot;one thousand forty six&quot;)
</I>&gt;<i> [macro-saynumber]
</I>&gt;<i> exten =&gt; s,1,Noop(Trying custom SayNumber playback for &quot;${ARG1}&quot;)
</I>&gt;<i> exten =&gt; s,n,Playback(tts/custom-${MD5(${ARG1})})
</I>&gt;<i> exten =&gt; s,n,GotoIf($[&quot;${PLAYBACKSTATUS}&quot;=&quot;SUCCESS&quot;]?done)
</I>&gt;<i> ; call tts-saynumber. This should set MACRO_OFFSET=101 if it was  
</I>&gt;<i> successful
</I>&gt;<i> exten =&gt; s,n(tts),Macro(tts-saynumber,${ARG1},${ARG2},${ARG3})
</I>&gt;<i> exten =&gt; s,n,SayNumber(${ARG1})
</I>&gt;<i> exten =&gt; s,n,Goto(done)
</I>&gt;<i> exten =&gt; s,tts+101,Noop(tts handled saynumber)
</I>&gt;<i>
</I>&gt;<i> ; Say digits is for saying digits one-by-one (eg, &quot;one zero four six&quot;)
</I>&gt;<i> [macro-saydigits]
</I>&gt;<i> exten =&gt; s,1,Noop(Trying custom SayDigits playback for &quot;${ARG1}&quot;)
</I>&gt;<i> exten =&gt; s,n,Playback(tts/custom-${MD5(${ARG1})})
</I>&gt;<i> exten =&gt; s,n,GotoIf($[&quot;${PLAYBACKSTATUS}&quot;=&quot;SUCCESS&quot;]?done)
</I>&gt;<i> ; call tts-saydigits. This should set MACRO_OFFSET=101 if it was  
</I>&gt;<i> successful
</I>&gt;<i> exten =&gt; s,n(tts),Macro(tts-saydigits,${ARG1},${ARG2},${ARG3})
</I>&gt;<i> exten =&gt; s,n,SayDigits(${ARG1})
</I>&gt;<i> exten =&gt; s,n,Goto(done)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ;
</I>&gt;<i> ;  
</I>&gt;<i> ############################################################################
</I>&gt;<i> ; Inbound Contexts [from]
</I>&gt;<i> ;  
</I>&gt;<i> ############################################################################
</I>&gt;<i>
</I>&gt;<i> [from-sip-external]
</I>&gt;<i> ;give external sip users congestion and hangup
</I>&gt;<i> ; Yes. This is _really_ meant to be _. - I know asterisk whinges  
</I>&gt;<i> about it, but
</I>&gt;<i> ; I do know what I'm doing. This is correct.
</I>&gt;<i> exten =&gt; _.,1,NoOp(Received incoming SIP connection from unknown  
</I>&gt;<i> peer to ${EXTEN})
</I>&gt;<i> exten =&gt; _.,n,Set(DID=${IF($[&quot;${EXTEN:1:2}&quot;=&quot;&quot;]?s:${EXTEN})})
</I>&gt;<i> exten =&gt; _.,n,Goto(s,1)
</I>&gt;<i> exten =&gt; s,1,GotoIf($[&quot;${ALLOW_SIP_ANON}&quot;=&quot;yes&quot;]?from-trunk,${DID},1)
</I>&gt;<i> exten =&gt; s,n,Set(TIMEOUT(absolute)=15)
</I>&gt;<i> exten =&gt; s,n,Answer
</I>&gt;<i> exten =&gt; s,n,Wait(2)
</I>&gt;<i> exten =&gt; s,n,Playback(ss-noservice)
</I>&gt;<i> exten =&gt; s,n,Playtones(congestion)
</I>&gt;<i> exten =&gt; s,n,Congestion(5)
</I>&gt;<i> exten =&gt; h,1,NoOp(Hangup)
</I>&gt;<i> exten =&gt; i,1,NoOp(Invalid)
</I>&gt;<i> exten =&gt; t,1,NoOp(Timeout)
</I>&gt;<i>
</I>&gt;<i> [from-internal-xfer]
</I>&gt;<i> ; applications are now mostly all found in from-internal-additional  
</I>&gt;<i> in _custom.conf
</I>&gt;<i> include =&gt; parkedcalls
</I>&gt;<i> include =&gt; from-internal-custom
</I>&gt;<i> ;allow phones to dial other extensions
</I>&gt;<i> include =&gt; ext-fax
</I>&gt;<i> ;allow phones to access generated contexts
</I>&gt;<i> ;
</I>&gt;<i> ; MODIFIED (PL)
</I>&gt;<i> ;
</I>&gt;<i> ; Currently the include for findmefollow is being auto-generated  
</I>&gt;<i> before ext-local which is the desired behavior.
</I>&gt;<i> ; However, I haven't been able to do anything that I know of to  
</I>&gt;<i> force this. We need to determine if it should
</I>&gt;<i> ; be hardcoded into here to make sure it doesn't change with some  
</I>&gt;<i> configuration. For now I will leave it out
</I>&gt;<i> ; until we can discuss this.
</I>&gt;<i> ;
</I>&gt;<i> include =&gt; ext-local-confirm
</I>&gt;<i> include =&gt; findmefollow-ringallv2
</I>&gt;<i> include =&gt; from-internal-additional
</I>&gt;<i> ; This causes grief with '#' transfers, commenting out for the moment.
</I>&gt;<i> ; include =&gt; bad-number
</I>&gt;<i> exten =&gt; s,1,Macro(hangupcall)
</I>&gt;<i> exten =&gt; h,1,Macro(hangupcall)
</I>&gt;<i>
</I>&gt;<i> [from-internal]
</I>&gt;<i> include =&gt; from-internal-xfer
</I>&gt;<i> include =&gt; bad-number
</I>&gt;<i>
</I>&gt;<i> ;------------------------------------------------------------------------
</I>&gt;<i> ; [macro-setmusic]
</I>&gt;<i> ;------------------------------------------------------------------------
</I>&gt;<i> ; CONTEXT:      macro-setmusic
</I>&gt;<i> ; PURPOSE:      to turn off moh on routes where it is not desired
</I>&gt;<i> ;
</I>&gt;<i> ;------------------------------------------------------------------------
</I>&gt;<i> [macro-setmusic]
</I>&gt;<i> exten =&gt; s,1,NoOp(Setting Outbound Route MoH To: ${ARG1})
</I>&gt;<i> exten =&gt; s,2,SetMusicOnHold(${ARG1})
</I>&gt;<i> ;------------------------------------------------------------------------
</I>&gt;<i>
</I>&gt;<i> ; ##########################################
</I>&gt;<i> ; ## Ring Groups with Confirmation macros ##
</I>&gt;<i> ; ##########################################
</I>&gt;<i> ; Used by followme and ringgroups
</I>&gt;<i>
</I>&gt;<i> ;------------------------------------------------------------------------
</I>&gt;<i> ; [macro-dial-confirm]
</I>&gt;<i> ;------------------------------------------------------------------------
</I>&gt;<i> ; This has now been incorporated into dialparties. It still only  
</I>&gt;<i> works with ringall
</I>&gt;<i> ; and ringall-prim strategies. Have not investigated why it doesn't  
</I>&gt;<i> work with
</I>&gt;<i> ; hunt and memory hunt.
</I>&gt;<i> ;
</I>&gt;<i> ;------------------------------------------------------------------------
</I>&gt;<i> [macro-dial-confirm]
</I>&gt;<i> ; This was written to make it easy to use macro-dial-confirm instead  
</I>&gt;<i> of macro-dial in generated dialplans.
</I>&gt;<i> ; This takes the same paramaters, with an additional paramater of  
</I>&gt;<i> the ring group Number
</I>&gt;<i> ; ARG1 is the timeout
</I>&gt;<i> ; ARG2 is the DIAL_OPTIONS
</I>&gt;<i> ; ARG3 is a list of xtns to call - 203-222-240-123123123#-211
</I>&gt;<i> ; ARG4 is the ring group number
</I>&gt;<i>
</I>&gt;<i> ; This sets a unique value to indicate that the channel is ringing.  
</I>&gt;<i> This is used for warning slow
</I>&gt;<i> ; users that the call has already been picked up.
</I>&gt;<i> ;
</I>&gt;<i> exten =&gt; s,1,Set(DB(RG/${ARG4}/${CHANNEL})=RINGING)
</I>&gt;<i>
</I>&gt;<i> ; We need to keep that channel variable, because it'll change when  
</I>&gt;<i> we do this dial, so set it to
</I>&gt;<i> ; fallthrough to every sibling.
</I>&gt;<i> ;
</I>&gt;<i> exten =&gt; s,n,Set(__UNIQCHAN=${CHANNEL})
</I>&gt;<i>
</I>&gt;<i> ; The calling ringgroup should have set RingGroupMethod  
</I>&gt;<i> appropriately. We need to set two
</I>&gt;<i> ; additional parameters:
</I>&gt;<i> ;
</I>&gt;<i> ; USE_CONFIRMATION, RINGGROUP_INDEX
</I>&gt;<i> ;
</I>&gt;<i> ; Thse are passed to inform dialparties to place external calls  
</I>&gt;<i> through the [grps] context
</I>&gt;<i> ;
</I>&gt;<i> exten =&gt; s,n,Set(USE_CONFIRMATION=TRUE)
</I>&gt;<i> exten =&gt; s,n,Set(RINGGROUP_INDEX=${ARG4})
</I>&gt;<i> exten =&gt; s,n,Set(ARG4=) ; otherwise it gets passed to  
</I>&gt;<i> dialparties.agi which processes it (prob bug)
</I>&gt;<i>
</I>&gt;<i> exten =&gt; s,n,Macro(dial,${ARG1},${ARG2},${ARG3})
</I>&gt;<i>
</I>&gt;<i> ; delete the variable, if we are here, we are done trying to dial  
</I>&gt;<i> and it may have been left around
</I>&gt;<i> ;
</I>&gt;<i> exten =&gt; s,n,DBDel(RG/${RINGGROUP_INDEX}/${CHANNEL})
</I>&gt;<i> exten =&gt; s,n,Set(USE_CONFIRMATION=)
</I>&gt;<i> exten =&gt; s,n,Set(RINGGROUP_INDEX=)
</I>&gt;<i> ;------------------------------------------------------------------------
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ;------------------------------------------------------------------------
</I>&gt;<i> ; [ext-local-confirm]
</I>&gt;<i> ;------------------------------------------------------------------------
</I>&gt;<i> ; If call confirm is being used in a ringgroup, then calls that do  
</I>&gt;<i> not require confirmation are sent
</I>&gt;<i> ; to this extension instead of straight to the device.
</I>&gt;<i> ;
</I>&gt;<i> ; The sole purpose of sending them here is to make sure we run  
</I>&gt;<i> Macro(auto-confirm) if this
</I>&gt;<i> ; extension answers the line. This takes care of clearing the  
</I>&gt;<i> database key that is used to inform
</I>&gt;<i> ; other potential late comers that the extension has been answered  
</I>&gt;<i> by someone else.
</I>&gt;<i> ;
</I>&gt;<i> ; ALERT_INFO is deprecated in Asterisk 1.4 but still used throughout  
</I>&gt;<i> the FreePBX dialplan and
</I>&gt;<i> ; usually set by dialparties.agi. This allows ineritance. Since no  
</I>&gt;<i> dialparties.agi here, set the
</I>&gt;<i> ; header if it is set.
</I>&gt;<i> ;
</I>&gt;<i> ;------------------------------------------------------------------------
</I>&gt;<i> [ext-local-confirm]
</I>&gt;<i> exten =&gt; _LC-.,1,Noop(IN ext-local-confirm with - RT: ${RT}, RG_IDX:  
</I>&gt;<i> ${RG_IDX})
</I>&gt;<i> exten =&gt; _LC-.,n,GotoIf($[&quot;x${ALERT_INFO}&quot;=&quot;x&quot;]?godial)
</I>&gt;<i> exten =&gt; _LC-.,n,SIPAddHeader(Alert-Info: ${ALERT_INFO})
</I>&gt;<i> exten =&gt; _LC-.,n(godial),dial(${DB(DEVICE/${EXTEN:3}/dial)},$ 
</I>&gt;<i> {RT},M(auto-confirm^${RG_IDX})${DIAL_OPTIONS})
</I>&gt;<i>
</I>&gt;<i> ;------------------------------------------------------------------------
</I>&gt;<i> ; [findmefollow-ringallv2]
</I>&gt;<i> ;------------------------------------------------------------------------
</I>&gt;<i> ; This context, to be included in from-internal, implements the  
</I>&gt;<i> PreRing part of findmefollow
</I>&gt;<i> ; as well as the GroupRing part. It also communicates between the  
</I>&gt;<i> two so that if DND is set
</I>&gt;<i> ; on the primary extension, and mastermode is enabled, then the  
</I>&gt;<i> other extensions will not ring
</I>&gt;<i> ;
</I>&gt;<i> ;------------------------------------------------------------------------
</I>&gt;<i> [findmefollow-ringallv2]
</I>&gt;<i> exten =&gt; _FMPR-.,1,Noop(In FMPR ${FMGRP} with ${EXTEN:5})
</I>&gt;<i> exten =&gt; _FMPR-.,n,Set(RingGroupMethod=)
</I>&gt;<i> exten =&gt; _FMPR-.,n,Set(USE_CONFIRMATION=)
</I>&gt;<i> exten =&gt; _FMPR-.,n,Set(RINGGROUP_INDEX=)
</I>&gt;<i> exten =&gt; _FMPR-.,n,Macro(simple-dial,${EXTEN:5},${FMREALPRERING})
</I>&gt;<i> exten =&gt; _FMPR-.,n,GotoIf($[&quot;${DIALSTATUS}&quot; != &quot;BUSY&quot;]?nodnd)
</I>&gt;<i> exten =&gt; _FMPR-.,n,Set(DB(FM/DND/${FMGRP}/${FMUNIQUE})=DND)
</I>&gt;<i> exten =&gt; _FMPR-.,n(nodnd),Noop(Ending FMPR ${FMGRP} with ${EXTEN:5}  
</I>&gt;<i> and dialstatus ${DIALSTATUS})
</I>&gt;<i> exten =&gt; _FMPR-.,n,Hangup()
</I>&gt;<i>
</I>&gt;<i> exten =&gt; _FMGL-.,1,Noop(In FMGL ${FMGRP} with ${EXTEN:5})
</I>&gt;<i> exten =&gt; _FMGL-.,n,GotoIf($[&quot;${DB(FM/DND/${FMGRP}/${FMUNIQUE})}&quot; =  
</I>&gt;<i> &quot;DND&quot;]?dodnd)
</I>&gt;<i> exten =&gt; _FMGL-.,n,Wait(1)
</I>&gt;<i> exten =&gt; _FMGL-.,n,GotoIf($[&quot;${DB(FM/DND/${FMGRP}/${FMUNIQUE})}&quot; =  
</I>&gt;<i> &quot;DND&quot;]?dodnd)
</I>&gt;<i> exten =&gt; _FMGL-.,n,Wait(1)
</I>&gt;<i> exten =&gt; _FMGL-.,n,GotoIf($[&quot;${DB(FM/DND/${FMGRP}/${FMUNIQUE})}&quot; =  
</I>&gt;<i> &quot;DND&quot;]?dodnd)
</I>&gt;<i> exten =&gt; _FMGL-.,n,Wait(${FMPRERING})
</I>&gt;<i> exten =&gt; _FMGL-.,n,GotoIf($[&quot;${DB(FM/DND/${FMGRP}/${FMUNIQUE})}&quot; =  
</I>&gt;<i> &quot;DND&quot;]?dodnd)
</I>&gt;<i> exten =&gt; _FMGL-.,n,DBDel(FM/DND/${FMGRP}/${FMUNIQUE})
</I>&gt;<i> exten =&gt; _FMGL-.,n(dodial),Macro(dial,${FMGRPTIME},${DIAL_OPTIONS},$ 
</I>&gt;<i> {EXTEN:5})
</I>&gt;<i> exten =&gt; _FMGL-.,n,Noop(Ending FMGL ${FMGRP} with ${EXTEN:5} and  
</I>&gt;<i> dialstatus ${DIALSTATUS})
</I>&gt;<i> exten =&gt; _FMGL-.,n,Hangup()
</I>&gt;<i> exten =&gt; _FMGL-.,n+10(dodnd),DBDel(FM/DND/${FMGRP}/${FMUNIQUE})
</I>&gt;<i> exten =&gt; _FMGL-.,n,GotoIf($[&quot;${FMPRIME}&quot; = &quot;FALSE&quot;]?dodial)
</I>&gt;<i> exten =&gt; _FMGL-.,n,Noop(Got DND in FMGL ${FMGRP} with ${EXTEN:5} in $ 
</I>&gt;<i> {RingGroupMethod} mode, aborting)
</I>&gt;<i> exten =&gt; _FMGL-.,n,Hangup()
</I>&gt;<i>
</I>&gt;<i> ;------------------------------------------------------------------------
</I>&gt;<i> ; [block-cf]
</I>&gt;<i> ;------------------------------------------------------------------------
</I>&gt;<i> ; This context is set as a target with FORWARD_CONTEXT when Call  
</I>&gt;<i> Forwarding is set to be
</I>&gt;<i> ; ignored in a ringgoup or other features that may take advantage of  
</I>&gt;<i> this. Server side
</I>&gt;<i> ; CF is done in dialparties.agi but if a client device forwards a  
</I>&gt;<i> call, it will be caught
</I>&gt;<i> ; and blocked here.
</I>&gt;<i> ;------------------------------------------------------------------------
</I>&gt;<i> [block-cf]
</I>&gt;<i> exten =&gt; _X.,1,Noop(Blocking callforward to ${EXTEN} because CF is  
</I>&gt;<i> blocked)
</I>&gt;<i> exten =&gt; _X.,n,Hangup()
</I>&gt;<i>
</I>&gt;<i> ;------------------------------------------------------------------------
</I>&gt;<i>
</I>&gt;<i> ;  
</I>&gt;<i> ############################################################################
</I>&gt;<i> ; Extension Contexts [ext]
</I>&gt;<i> ;  
</I>&gt;<i> ############################################################################
</I>&gt;<i>
</I>&gt;<i> [ext-fax]
</I>&gt;<i> exten =&gt; s,1,Answer
</I>&gt;<i> exten =&gt; s,2,Goto(in_fax,1)
</I>&gt;<i> exten =&gt; in_fax,1,StopPlayTones
</I>&gt;<i> exten =&gt; in_fax,2,GotoIf($[&quot;${FAX_RX}&quot; = &quot;system&quot;]?3:analog_fax,1)
</I>&gt;<i> exten =&gt; in_fax,3,Macro(faxreceive)
</I>&gt;<i> exten =&gt; in_fax,4,Hangup
</I>&gt;<i> exten =&gt; analog_fax,1,GotoIf($[&quot;${FAX_RX}&quot; = &quot;disabled&quot;]?4:2)  ;if  
</I>&gt;<i> fax is disabled, just hang up
</I>&gt;<i> exten =&gt; analog_fax,2,Set(DIAL=${DB(DEVICE/${FAX_RX}/dial)});
</I>&gt;<i> exten =&gt; analog_fax,3,Dial(${DIAL},20,d)
</I>&gt;<i> exten =&gt; analog_fax,4,Hangup
</I>&gt;<i> ;exten =&gt; out_fax,1,wait(7)
</I>&gt;<i> exten =&gt; out_fax,1,txfax(${TXFAX_NAME},caller)
</I>&gt;<i> exten =&gt; out_fax,2,Hangup
</I>&gt;<i> exten =&gt; h,1,system(/var/lib/asterisk/bin/fax-process.pl --to $ 
</I>&gt;<i> {EMAILADDR} --from ${FAX_RX_FROM} --dest &quot;${FROM_DID}&quot; --subject  
</I>&gt;<i> &quot;Fax from ${URIENCODE(${CALLERID(number)})} ${URIENCODE($ 
</I>&gt;<i> {CALLERID(name)})}&quot; --attachment fax_${URIENCODE($ 
</I>&gt;<i> {CALLERID(number)})}.pdf --type application/pdf --file ${FAXFILE});
</I>&gt;<i> exten =&gt; h,2,Hangup()
</I>&gt;<i>
</I>&gt;<i> ;this is where parked calls go if they time-out.  Should probably re- 
</I>&gt;<i> ring
</I>&gt;<i> [default]
</I>&gt;<i> include =&gt; ext-local
</I>&gt;<i> exten =&gt; s,1,Playback(vm-goodbye)
</I>&gt;<i> exten =&gt; s,2,Macro(hangupcall)
</I>&gt;<i>
</I>&gt;<i> -------------------------------------------------------------------------------------------------
</I>&gt;<i>
</I>&gt;<i> Thanks for the help!!!!
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Juan A. Quintana
</I>&gt;<i> www.simplifieditsolutions.com
</I>&gt;<i> Simplified IT Solutions
</I>&gt;<i> Network Consultant
</I>&gt;<i> 8002 Thorncroft Manor Ln
</I>&gt;<i> Richmond, TX 77407
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> E-mail:
</I>&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/chan-sccp-users">jquintana at simplifieditsolutions.com</A>
</I>&gt;<i>
</I>&gt;<i>                                Office:
</I>&gt;<i>                                832.798.5989
</I>&gt;<i> We do IT right.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> The information contained in this E-mail message is privileged,  
</I>&gt;<i> confidential, and may be protected from disclosure; please be aware  
</I>&gt;<i> that any other use, printing, copying, disclosure or dissemination  
</I>&gt;<i> of this communication may be subject to legal restriction or  
</I>&gt;<i> sanction. If you think that you have received this e-mail message in  
</I>&gt;<i> error, please reply to the sender.
</I>&gt;<i>
</I>&gt;<i> This E-mail message and any attachments hereto have been scanned for  
</I>&gt;<i> viruses and are believed to be free of any virus or other defect  
</I>&gt;<i> that might affect any computer system into which it is received and  
</I>&gt;<i> opened. However, it is the responsibility of the recipient to ensure  
</I>&gt;<i> that it is virus free and no responsibility is accepted by  
</I>&gt;<i> Simplified IT Solutions for any loss or damage arising in any way  
</I>&gt;<i> from its use.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> -----Original Message-----
</I>&gt;<i> From: <A HREF="https://lists.berlios.de/mailman/listinfo/chan-sccp-users">chan-sccp-users-bounces at lists.berlios.de</A> [mailto:<A HREF="https://lists.berlios.de/mailman/listinfo/chan-sccp-users">chan-sccp-users-bounces at lists.berlios.de</A> 
</I>&gt;<i> ] On Behalf Of <A HREF="https://lists.berlios.de/mailman/listinfo/chan-sccp-users">chan-sccp-users-request at lists.berlios.de</A>
</I>&gt;<i> Sent: Tuesday, November 24, 2009 8:22 PM
</I>&gt;<i> To: <A HREF="https://lists.berlios.de/mailman/listinfo/chan-sccp-users">chan-sccp-users at lists.berlios.de</A>
</I>&gt;<i> Subject: Chan-sccp-users Digest, Vol 32, Issue 2
</I>&gt;<i>
</I>&gt;<i> Send Chan-sccp-users mailing list submissions to
</I>&gt;<i> 	<A HREF="https://lists.berlios.de/mailman/listinfo/chan-sccp-users">chan-sccp-users at lists.berlios.de</A>
</I>&gt;<i>
</I>&gt;<i> To subscribe or unsubscribe via the World Wide Web, visit
</I>&gt;<i> 	<A HREF="https://lists.berlios.de/mailman/listinfo/chan-sccp-users">https://lists.berlios.de/mailman/listinfo/chan-sccp-users</A>
</I>&gt;<i> or, via email, send a message with subject or body 'help' to
</I>&gt;<i> 	<A HREF="https://lists.berlios.de/mailman/listinfo/chan-sccp-users">chan-sccp-users-request at lists.berlios.de</A>
</I>&gt;<i>
</I>&gt;<i> You can reach the person managing the list at
</I>&gt;<i> 	<A HREF="https://lists.berlios.de/mailman/listinfo/chan-sccp-users">chan-sccp-users-owner at lists.berlios.de</A>
</I>&gt;<i>
</I>&gt;<i> When replying, please edit your Subject line so it is more specific
</I>&gt;<i> than &quot;Re: Contents of Chan-sccp-users digest...&quot;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Today's Topics:
</I>&gt;<i>
</I>&gt;<i>   1. Re: Unable to Make Calls Using SCCP (Peder)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ----------------------------------------------------------------------
</I>&gt;<i>
</I>&gt;<i> Message: 1
</I>&gt;<i> Date: Tue, 24 Nov 2009 20:02:53 -0600
</I>&gt;<i> From: &quot;Peder&quot; &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/chan-sccp-users">peder at networkoblivion.com</A>&gt;
</I>&gt;<i> Subject: Re: [Chan-sccp-users] Unable to Make Calls Using SCCP
</I>&gt;<i> To: &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/chan-sccp-users">chan-sccp-users at lists.berlios.de</A>&gt;
</I>&gt;<i> Message-ID: &lt;08d501ca6d73$664d9eb0$32e8dc10$@com&gt;
</I>&gt;<i> Content-Type: text/plain; charset=&quot;us-ascii&quot;
</I>&gt;<i>
</I>&gt;<i> Can you post debug of calls and sip.conf and extensions.conf for the
</I>&gt;<i> portions relative to the phones.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> From: <A HREF="https://lists.berlios.de/mailman/listinfo/chan-sccp-users">chan-sccp-users-bounces at lists.berlios.de</A>
</I>&gt;<i> [mailto:<A HREF="https://lists.berlios.de/mailman/listinfo/chan-sccp-users">chan-sccp-users-bounces at lists.berlios.de</A>] On Behalf Of Juan A.
</I>&gt;<i> Quintana
</I>&gt;<i> Sent: Tuesday, November 24, 2009 7:36 PM
</I>&gt;<i> To: <A HREF="https://lists.berlios.de/mailman/listinfo/chan-sccp-users">chan-sccp-users at lists.berlios.de</A>
</I>&gt;<i> Subject: [Chan-sccp-users] Unable to Make Calls Using SCCP
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Hello, all. I have a Cisco 7960G loaded with the SCCP firmware that  
</I>&gt;<i> I am
</I>&gt;<i> testing. My problem is that I am able to receive calls but cannot make
</I>&gt;<i> calls. If I dial an extension or a 10 digit number I just get a busy  
</I>&gt;<i> tone.
</I>&gt;<i>
</I>&gt;<i> I am able to dial out from my SIP phones without a problem.
</I>&gt;<i>
</I>&gt;<i> I have a couple of ringtones in my tftp folder that are not being  
</I>&gt;<i> downloaded
</I>&gt;<i> by the sccp phone,either. Maybe the phone isnt getting the dialplan  
</I>&gt;<i> from the
</I>&gt;<i> tftp folder?
</I>&gt;<i>
</I>&gt;<i> Any help is greatly appreciated!
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Juan A. Quintana
</I>&gt;<i>
</I>&gt;<i> &lt;<A HREF="http://www.simplifieditsolutions.com/">http://www.simplifieditsolutions.com/</A>&gt; www.simplifieditsolutions.com
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Simplified IT Solutions
</I>&gt;<i> Network Consultant
</I>&gt;<i>
</I>&gt;<i> 8002 Thorncroft Manor Ln
</I>&gt;<i> Richmond, TX 77407
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> E-mail:
</I>&gt;<i> &lt;mailto:<A HREF="https://lists.berlios.de/mailman/listinfo/chan-sccp-users">jquintana at simplifieditsolutions.com</A>&gt;
</I>&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/chan-sccp-users">jquintana at simplifieditsolutions.com</A>
</I>&gt;<i>
</I>&gt;<i> 	                               Office:
</I>&gt;<i>
</I>&gt;<i>                               832.798.5989
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> We do IT right.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &lt;<A HREF="http://www.twitter.com/simplifiedIT">http://www.twitter.com/simplifiedIT</A>&gt; follow-us-on-twitter
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> The information contained in this E-mail message is privileged,
</I>&gt;<i> confidential, and may be protected from disclosure; please be aware  
</I>&gt;<i> that any
</I>&gt;<i> other use, printing, copying, disclosure or dissemination of this
</I>&gt;<i> communication may be subject to legal restriction or sanction. If  
</I>&gt;<i> you think
</I>&gt;<i> that you have received this e-mail message in error, please reply to  
</I>&gt;<i> the
</I>&gt;<i> sender.
</I>&gt;<i>
</I>&gt;<i> This E-mail message and any attachments hereto have been scanned for  
</I>&gt;<i> viruses
</I>&gt;<i> and are believed to be free of any virus or other defect that might  
</I>&gt;<i> affect
</I>&gt;<i> any computer system into which it is received and opened. However,  
</I>&gt;<i> it is the
</I>&gt;<i> responsibility of the recipient to ensure that it is virus free and no
</I>&gt;<i> responsibility is accepted by Simplified IT Solutions for any loss  
</I>&gt;<i> or damage
</I>&gt;<i> arising in any way from its use.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> -------------- next part --------------
</I>&gt;<i> An HTML attachment was scrubbed...
</I>&gt;<i> URL: <A HREF="https://lists.berlios.de/pipermail/chan-sccp-users/attachments/20091124/024fdaa0/attachment.html">https://lists.berlios.de/pipermail/chan-sccp-users/attachments/20091124/024fdaa0/attachment.html</A>
</I>&gt;<i> -------------- next part --------------
</I>&gt;<i> A non-text attachment was scrubbed...
</I>&gt;<i> Name: not available
</I>&gt;<i> Type: image/png
</I>&gt;<i> Size: 20527 bytes
</I>&gt;<i> Desc: not available
</I>&gt;<i> Url : <A HREF="https://lists.berlios.de/pipermail/chan-sccp-users/attachments/20091124/024fdaa0/attachment.png">https://lists.berlios.de/pipermail/chan-sccp-users/attachments/20091124/024fdaa0/attachment.png</A>
</I>&gt;<i>
</I>&gt;<i> ------------------------------
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Chan-sccp-users mailing list
</I>&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/chan-sccp-users">Chan-sccp-users at lists.berlios.de</A>
</I>&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/chan-sccp-users">https://lists.berlios.de/mailman/listinfo/chan-sccp-users</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> End of Chan-sccp-users Digest, Vol 32, Issue 2
</I>&gt;<i> **********************************************
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Chan-sccp-users mailing list
</I>&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/chan-sccp-users">Chan-sccp-users at lists.berlios.de</A>
</I>&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/chan-sccp-users">https://lists.berlios.de/mailman/listinfo/chan-sccp-users</A>
</I>


------------------------------

_______________________________________________
Chan-sccp-users mailing list
<A HREF="https://lists.berlios.de/mailman/listinfo/chan-sccp-users">Chan-sccp-users at lists.berlios.de</A>
<A HREF="https://lists.berlios.de/mailman/listinfo/chan-sccp-users">https://lists.berlios.de/mailman/listinfo/chan-sccp-users</A>


End of Chan-sccp-users Digest, Vol 33, Issue 1
**********************************************
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: sccp.txt
URL: &lt;<A HREF="https://lists.berlios.de/pipermail/chan-sccp-users/attachments/20091201/06601bf1/attachment.txt">https://lists.berlios.de/pipermail/chan-sccp-users/attachments/20091201/06601bf1/attachment.txt</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000489.html">[Chan-sccp-users] Chan-sccp-users Digest, Vol 32, Issue 2
</A></li>
	<LI>Next message: <A HREF="000491.html">[Chan-sccp-users] Chan-sccp-users Digest, Vol 33, Issue 1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#490">[ date ]</a>
              <a href="thread.html#490">[ thread ]</a>
              <a href="subject.html#490">[ subject ]</a>
              <a href="author.html#490">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/chan-sccp-users">More information about the Chan-sccp-users
mailing list</a><br>
</body></html>
